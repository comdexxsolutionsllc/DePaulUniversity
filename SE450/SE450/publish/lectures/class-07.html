<?xml version="1.0"?>
<!--Generated by an XSL stylesheet.  Do not edit!-->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta http-equiv="Expires" content="Mon, 10 Jan 2000 12:00:00 GMT"/><style type="text/css">
    p.flushtop     { margin-top: 0px; }
    p.flushbottom  { margin-bottom: 0px; }
    p.flush        { margin-top: 0px;
                     margin-bottom: 0px; }
    h1             { margin-top: 0px;
                     font-weight: bold;
                     font-size: large; }
    h2             { margin-top: 0px;
                     font-weight: bold;
                     font-size: medium; }
    body           { color: black;
                     background-color: white; }
    img.noborder   { border-width: 0px; }
    table.title    { border-style: solid; 
                     border-width: 1px; 
                     border-color: #888888; 
                     color: black;
                     background-color: #E4E4C2; }
    table.item     { border-style: solid; 
                     border-width: 1px; 
                     border-color: #888888; 
                     color: black;
                     background-color: #F4F4E0; }
    table.notes    { border-width: 0px; 
                     color: black;
                     background-color: #E0F4E0; }
    table.comment  { border-width: 0px; 
                     color: black;
                     background-color: #E0F4E0; }
    table.code     { border-style: solid; 
                     border-width: 1px; 
                     border-color: #888888; 
                     color: black;
                     background-color: #E0F4E0; }
    table.contents { border-width: 0px; 
                     color: black;
                     background-color: #FFFFFF; }
    span.red       { color: red; }
    span.orange    { color: orange; }
    span.purple    { color: purple; }
    span.blue      { color: blue; }
    span.brown     { color: brown; }
    span.green     { color: lime; }
    span.hilight   { background-color: #E4E4C2; }
  </style><title>SE450:  Lecture 7 
      [2008/10/21]
    </title></head><body><h1><a href="../index.html">SE450</a>:  Lecture 7 
      (Simulation, Null Objects, Proxies)
    </h1><table width="100%" class="title"><tr><td><span style="font-weight: bold; font-size: larger"><a name="slide000">Contents</a></span><span style="font-weight: normal"><a href="class-07-000.html"> [0/13] </a></span></td></tr></table><p> </p><table width="100%" cellpadding="0" cellspacing="0" class="contents"><tr><td><a href="#slide001">Proxy: Unmodifiable Collection</a> [1/13] </td></tr><tr><td><a href="#slide002">Proxy: Another Example</a> [2/13] </td></tr><tr><td><a href="#slide003">Simulation: Active and Passive Objects</a> [3/13] </td></tr><tr><td><a href="#slide004">Simulation: Example 1</a> [4/13] </td></tr><tr><td><a href="#slide005">Simulation: Example 2</a> [5/13] </td></tr><tr><td><a href="#slide006">Simulation: Example 3</a> [6/13] </td></tr><tr><td><a href="#slide007">Simulation: Example 4</a> [7/13] </td></tr><tr><td><a href="#slide008">Simulation: TimeServer Implementation</a> [8/13] </td></tr><tr><td><a href="#slide009">Simulation: Random numbers</a> [9/13] </td></tr><tr><td><a href="#slide010">Project: Car Movement</a> [10/13] </td></tr><tr><td><a href="#slide011">Project: Lights</a> [11/13] </td></tr><tr><td><a href="#slide012">Project: Creating the road graph</a> [12/13] </td></tr><tr><td><a href="#slide013">Project: Notes</a> [13/13] </td></tr></table><br/><table width="100%" class="title"><tr><td><span style="font-weight: bold; font-size: larger"><a name="slide001">Proxy: Unmodifiable Collection</a></span><span style="font-weight: normal"><a href="class-07-001.html"> [1/13] </a></span></td></tr></table><p> </p>
        <p xmlns=""> </p><blockquote xmlns="">
<table width="97%">
<tr><td rowspan="1" colspan="1"><table width="100%" class="title"><tr><td rowspan="1" colspan="1"><b><a xmlns="http://www.w3.org/1999/xhtml" href="../code/html/proxy/UnmodifiableCollection_java.html">file:UnmodifiableCollection.java</a> [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/src/proxy/UnmodifiableCollection.java">source</a>] [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/doc-publicproxy/UnmodifiableCollection.html">doc-public</a>] [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/doc-privateproxy/UnmodifiableCollection.html">doc-private</a>]</b></td></tr></table></td></tr>
<tr><td rowspan="1" colspan="1"><table width="100%" class="code"><tr><td rowspan="1" colspan="1">

<pre xml:space="preserve"><tt><span style="color: #000000">00001:</span> <span style="font-weight: bold"><span style="color: #000080">package</span></span> proxy<span style="color: #990000">;</span>
<span style="color: #000000">00002:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> java<span style="color: #990000">.</span>util<span style="color: #990000">.</span>Collection<span style="color: #990000">;</span>
<span style="color: #000000">00003:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> java<span style="color: #990000">.</span>util<span style="color: #990000">.</span>Iterator<span style="color: #990000">;</span>
<span style="color: #000000">00004:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> java<span style="color: #990000">.</span>io<span style="color: #990000">.</span>Serializable<span style="color: #990000">;</span>
<span style="color: #000000">00005:</span> 
<span style="color: #000000">00006:</span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">UnmodifiableCollection</span><span style="color: #990000">&lt;</span>E<span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #0000FF">implements</span></span> Collection<span style="color: #990000">&lt;</span>E<span style="color: #990000">&gt;,</span> Serializable <span style="color: #FF0000">{</span>
<span style="color: #000000">00007:</span>   Collection<span style="color: #990000">&lt;</span>E<span style="color: #990000">&gt;</span> _c<span style="color: #990000">;</span>
<span style="color: #000000">00008:</span>   
<span style="color: #000000">00009:</span>   <span style="font-weight: bold"><span style="color: #000000">UnmodifiableCollection</span></span><span style="color: #990000">(</span><span style="color: #008080">Collection&lt;E&gt;</span> c<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00010:</span>     <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>c<span style="color: #990000">==</span><span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">)</span>
<span style="color: #000000">00011:</span>       <span style="font-weight: bold"><span style="color: #0000FF">throw</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">NullPointerException</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00012:</span>     _c <span style="color: #990000">=</span> c<span style="color: #990000">;</span>
<span style="color: #000000">00013:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00014:</span>   
<span style="color: #000000">00015:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">int</span>      <span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">()</span>                       <span style="color: #FF0000">{</span><span style="font-weight: bold"><span style="color: #0000FF">return</span></span> _c<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">();</span><span style="color: #FF0000">}</span>
<span style="color: #000000">00016:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">boolean</span>  <span style="font-weight: bold"><span style="color: #000000">isEmpty</span></span><span style="color: #990000">()</span>                    <span style="color: #FF0000">{</span><span style="font-weight: bold"><span style="color: #0000FF">return</span></span> _c<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">isEmpty</span></span><span style="color: #990000">();</span><span style="color: #FF0000">}</span>
<span style="color: #000000">00017:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">boolean</span>  <span style="font-weight: bold"><span style="color: #000000">contains</span></span><span style="color: #990000">(</span><span style="color: #008080">Object</span> o<span style="color: #990000">)</span>           <span style="color: #FF0000">{</span><span style="font-weight: bold"><span style="color: #0000FF">return</span></span> _c<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">contains</span></span><span style="color: #990000">(</span>o<span style="color: #990000">);</span><span style="color: #FF0000">}</span>
<span style="color: #000000">00018:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> Object<span style="color: #990000">[]</span> <span style="font-weight: bold"><span style="color: #000000">toArray</span></span><span style="color: #990000">()</span>                    <span style="color: #FF0000">{</span><span style="font-weight: bold"><span style="color: #0000FF">return</span></span> _c<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">toArray</span></span><span style="color: #990000">();</span><span style="color: #FF0000">}</span>
<span style="color: #000000">00019:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #990000">&lt;</span>T<span style="color: #990000">&gt;</span> T<span style="color: #990000">[]</span>  <span style="font-weight: bold"><span style="color: #000000">toArray</span></span><span style="color: #990000">(</span>T<span style="color: #990000">[]</span> a<span style="color: #990000">)</span>               <span style="color: #FF0000">{</span><span style="font-weight: bold"><span style="color: #0000FF">return</span></span> _c<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">toArray</span></span><span style="color: #990000">(</span>a<span style="color: #990000">);</span><span style="color: #FF0000">}</span>
<span style="color: #000000">00020:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #008080">String</span>   <span style="font-weight: bold"><span style="color: #000000">toString</span></span><span style="color: #990000">()</span>                   <span style="color: #FF0000">{</span><span style="font-weight: bold"><span style="color: #0000FF">return</span></span> _c<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">toString</span></span><span style="color: #990000">();</span><span style="color: #FF0000">}</span>
<span style="color: #000000">00021:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">boolean</span>  <span style="font-weight: bold"><span style="color: #000000">containsAll</span></span><span style="color: #990000">(</span><span style="color: #008080">Collection&lt;?&gt;</span> d<span style="color: #990000">)</span> <span style="color: #FF0000">{</span><span style="font-weight: bold"><span style="color: #0000FF">return</span></span> _c<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">containsAll</span></span><span style="color: #990000">(</span>d<span style="color: #990000">);</span><span style="color: #FF0000">}</span>
<span style="color: #000000">00022:</span>   
<span style="color: #000000">00023:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #008080">Iterator&lt;E&gt;</span> <span style="font-weight: bold"><span style="color: #000000">iterator</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00024:</span>     <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> Iterator<span style="color: #990000">&lt;</span>E<span style="color: #990000">&gt;()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00025:</span>         <span style="color: #008080">Iterator&lt;E&gt;</span> i <span style="color: #990000">=</span> UnmodifiableCollection<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>_c<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">iterator</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00026:</span>         
<span style="color: #000000">00027:</span>         <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">boolean</span> <span style="font-weight: bold"><span style="color: #000000">hasNext</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span><span style="font-weight: bold"><span style="color: #0000FF">return</span></span> i<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">hasNext</span></span><span style="color: #990000">();</span><span style="color: #FF0000">}</span>
<span style="color: #000000">00028:</span>         <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #008080">E</span> <span style="font-weight: bold"><span style="color: #000000">next</span></span><span style="color: #990000">()</span>          <span style="color: #FF0000">{</span><span style="font-weight: bold"><span style="color: #0000FF">return</span></span> i<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">next</span></span><span style="color: #990000">();</span><span style="color: #FF0000">}</span>
<span style="color: #000000">00029:</span>         <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">remove</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00030:</span>           <span style="font-weight: bold"><span style="color: #0000FF">throw</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">UnsupportedOperationException</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00031:</span>         <span style="color: #FF0000">}</span>
<span style="color: #000000">00032:</span>       <span style="color: #FF0000">}</span><span style="color: #990000">;</span>
<span style="color: #000000">00033:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00034:</span>   
<span style="color: #000000">00035:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">boolean</span> <span style="font-weight: bold"><span style="color: #000000">add</span></span><span style="color: #990000">(</span><span style="color: #008080">Object</span> o<span style="color: #990000">)</span><span style="color: #FF0000">{</span>
<span style="color: #000000">00036:</span>     <span style="font-weight: bold"><span style="color: #0000FF">throw</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">UnsupportedOperationException</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00037:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00038:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">boolean</span> <span style="font-weight: bold"><span style="color: #000000">remove</span></span><span style="color: #990000">(</span><span style="color: #008080">Object</span> o<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00039:</span>     <span style="font-weight: bold"><span style="color: #0000FF">throw</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">UnsupportedOperationException</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00040:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00041:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">boolean</span> <span style="font-weight: bold"><span style="color: #000000">addAll</span></span><span style="color: #990000">(</span><span style="color: #008080">Collection&lt;? extends E&gt;</span> c<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00042:</span>     <span style="font-weight: bold"><span style="color: #0000FF">throw</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">UnsupportedOperationException</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00043:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00044:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">boolean</span> <span style="font-weight: bold"><span style="color: #000000">removeAll</span></span><span style="color: #990000">(</span><span style="color: #008080">Collection&lt;?&gt;</span> c<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00045:</span>     <span style="font-weight: bold"><span style="color: #0000FF">throw</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">UnsupportedOperationException</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00046:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00047:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">boolean</span> <span style="font-weight: bold"><span style="color: #000000">retainAll</span></span><span style="color: #990000">(</span><span style="color: #008080">Collection&lt;?&gt;</span> c<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00048:</span>     <span style="font-weight: bold"><span style="color: #0000FF">throw</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">UnsupportedOperationException</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00049:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00050:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">clear</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00051:</span>     <span style="font-weight: bold"><span style="color: #0000FF">throw</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">UnsupportedOperationException</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00052:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00053:</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00054:</span> </tt></pre>

</td></tr></table>
</td></tr></table>
</blockquote>
      <p> </p><table width="100%" class="title"><tr><td><span style="font-weight: bold; font-size: larger"><a name="slide002">Proxy: Another Example</a></span><span style="font-weight: normal"><a href="class-07-002.html"> [2/13] </a></span></td></tr></table><p> </p>
        <p xmlns="">From Head first Design Patterns</p>
        <p xmlns=""> </p><blockquote xmlns="">
<table width="97%">
<tr><td rowspan="1" colspan="1"><table width="100%" class="title"><tr><td rowspan="1" colspan="1"><b><a xmlns="http://www.w3.org/1999/xhtml" href="../code/html/headfirst/proxy/virtualproxy/ImageProxy_java.html">file:ImageProxy.java</a> [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/src/headfirst/proxy/virtualproxy/ImageProxy.java">source</a>] [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/doc-publicheadfirst/proxy/virtualproxy/ImageProxy.html">doc-public</a>] [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/doc-privateheadfirst/proxy/virtualproxy/ImageProxy.html">doc-private</a>]</b></td></tr></table></td></tr>
<tr><td rowspan="1" colspan="1"><table width="100%" class="code"><tr><td rowspan="1" colspan="1">

<pre xml:space="preserve"><tt><span style="color: #000000">00001:</span> <span style="font-weight: bold"><span style="color: #000080">package</span></span> headfirst<span style="color: #990000">.</span>proxy<span style="color: #990000">.</span>virtualproxy<span style="color: #990000">;</span>
<span style="color: #000000">00002:</span> 
<span style="color: #000000">00003:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> java<span style="color: #990000">.</span>net<span style="color: #990000">.*;</span>
<span style="color: #000000">00004:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> java<span style="color: #990000">.</span>awt<span style="color: #990000">.*;</span>
<span style="color: #000000">00005:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> java<span style="color: #990000">.</span>awt<span style="color: #990000">.</span>event<span style="color: #990000">.*;</span>
<span style="color: #000000">00006:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> javax<span style="color: #990000">.</span>swing<span style="color: #990000">.*;</span>
<span style="color: #000000">00007:</span> 
<span style="color: #000000">00008:</span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">ImageProxy</span> <span style="font-weight: bold"><span style="color: #0000FF">implements</span></span> Icon <span style="color: #FF0000">{</span>
<span style="color: #000000">00009:</span>         <span style="color: #008080">ImageIcon</span> imageIcon<span style="color: #990000">;</span>
<span style="color: #000000">00010:</span>         <span style="color: #008080">URL</span> imageURL<span style="color: #990000">;</span>
<span style="color: #000000">00011:</span>         <span style="color: #008080">Thread</span> retrievalThread<span style="color: #990000">;</span>
<span style="color: #000000">00012:</span>         <span style="color: #009900">boolean</span> retrieving <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
<span style="color: #000000">00013:</span>      
<span style="color: #000000">00014:</span>         <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #000000">ImageProxy</span></span><span style="color: #990000">(</span><span style="color: #008080">URL</span> url<span style="color: #990000">)</span> <span style="color: #FF0000">{</span> imageURL <span style="color: #990000">=</span> url<span style="color: #990000">;</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00015:</span>      
<span style="color: #000000">00016:</span>         <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">getIconWidth</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00017:</span>                 <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>imageIcon <span style="color: #990000">!=</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00018:</span>             <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> imageIcon<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getIconWidth</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00019:</span>         <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00020:</span>                         <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">800</span><span style="color: #990000">;</span>
<span style="color: #000000">00021:</span>                 <span style="color: #FF0000">}</span>
<span style="color: #000000">00022:</span>         <span style="color: #FF0000">}</span>
<span style="color: #000000">00023:</span>  
<span style="color: #000000">00024:</span>         <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">getIconHeight</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00025:</span>                 <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>imageIcon <span style="color: #990000">!=</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00026:</span>             <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> imageIcon<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getIconHeight</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00027:</span>         <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00028:</span>                         <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">600</span><span style="color: #990000">;</span>
<span style="color: #000000">00029:</span>                 <span style="color: #FF0000">}</span>
<span style="color: #000000">00030:</span>         <span style="color: #FF0000">}</span>
<span style="color: #000000">00031:</span>      
<span style="color: #000000">00032:</span>         <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">paintIcon</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">final</span></span> <span style="color: #008080">Component</span> c<span style="color: #990000">,</span> <span style="color: #008080">Graphics</span>  g<span style="color: #990000">,</span> <span style="color: #009900">int</span> x<span style="color: #990000">,</span>  <span style="color: #009900">int</span> y<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00033:</span>                 <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>imageIcon <span style="color: #990000">!=</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00034:</span>                         imageIcon<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">paintIcon</span></span><span style="color: #990000">(</span>c<span style="color: #990000">,</span> g<span style="color: #990000">,</span> x<span style="color: #990000">,</span> y<span style="color: #990000">);</span>
<span style="color: #000000">00035:</span>                 <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00036:</span>                         g<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">drawString</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Loading CD cover, please wait..."</span><span style="color: #990000">,</span> x<span style="color: #990000">+</span><span style="color: #993399">300</span><span style="color: #990000">,</span> y<span style="color: #990000">+</span><span style="color: #993399">190</span><span style="color: #990000">);</span>
<span style="color: #000000">00037:</span>                         <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(!</span>retrieving<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00038:</span>                                 retrieving <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">;</span>
<span style="color: #000000">00039:</span> 
<span style="color: #000000">00040:</span>                                 retrievalThread <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Thread</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Runnable</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00041:</span>                                         <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00042:</span>                                                 <span style="font-weight: bold"><span style="color: #0000FF">try</span></span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00043:</span>                                                         imageIcon <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ImageIcon</span></span><span style="color: #990000">(</span>imageURL<span style="color: #990000">,</span> <span style="color: #FF0000">"CD Cover"</span><span style="color: #990000">);</span>
<span style="color: #000000">00044:</span>                                                         c<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">repaint</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00045:</span>                                                 <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">catch</span></span> <span style="color: #990000">(</span><span style="color: #008080">Exception</span> e<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00046:</span>                                                         e<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printStackTrace</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00047:</span>                                                 <span style="color: #FF0000">}</span>
<span style="color: #000000">00048:</span>                                         <span style="color: #FF0000">}</span>
<span style="color: #000000">00049:</span>                                 <span style="color: #FF0000">}</span><span style="color: #990000">);</span>
<span style="color: #000000">00050:</span>                                 retrievalThread<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">start</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00051:</span>                         <span style="color: #FF0000">}</span>
<span style="color: #000000">00052:</span>                 <span style="color: #FF0000">}</span>
<span style="color: #000000">00053:</span>         <span style="color: #FF0000">}</span>
<span style="color: #000000">00054:</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00055:</span> </tt></pre>

</td></tr></table>
</td></tr></table>
</blockquote>
        <p xmlns=""> </p><blockquote xmlns="">
<table width="97%">
<tr><td rowspan="1" colspan="1"><table width="100%" class="title"><tr><td rowspan="1" colspan="1"><b><a xmlns="http://www.w3.org/1999/xhtml" href="../code/html/headfirst/proxy/virtualproxy/ImageProxyTestDrive_java.html">file:ImageProxyTestDrive.java</a> [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/src/headfirst/proxy/virtualproxy/ImageProxyTestDrive.java">source</a>] [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/doc-publicheadfirst/proxy/virtualproxy/ImageProxyTestDrive.html">doc-public</a>] [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/doc-privateheadfirst/proxy/virtualproxy/ImageProxyTestDrive.html">doc-private</a>]</b></td></tr></table></td></tr>
<tr><td rowspan="1" colspan="1"><table width="100%" class="code"><tr><td rowspan="1" colspan="1">

<pre xml:space="preserve"><tt><span style="color: #000000">00001:</span> <span style="font-weight: bold"><span style="color: #000080">package</span></span> headfirst<span style="color: #990000">.</span>proxy<span style="color: #990000">.</span>virtualproxy<span style="color: #990000">;</span>
<span style="color: #000000">00002:</span> 
<span style="color: #000000">00003:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> java<span style="color: #990000">.</span>net<span style="color: #990000">.*;</span>
<span style="color: #000000">00004:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> java<span style="color: #990000">.</span>awt<span style="color: #990000">.*;</span>
<span style="color: #000000">00005:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> java<span style="color: #990000">.</span>awt<span style="color: #990000">.</span>event<span style="color: #990000">.*;</span>
<span style="color: #000000">00006:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> javax<span style="color: #990000">.</span>swing<span style="color: #990000">.*;</span>
<span style="color: #000000">00007:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> java<span style="color: #990000">.</span>util<span style="color: #990000">.*;</span>
<span style="color: #000000">00008:</span> 
<span style="color: #000000">00009:</span> <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">ImageProxyTestDrive</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00010:</span>         <span style="color: #008080">ImageComponent</span> imageComponent<span style="color: #990000">;</span>
<span style="color: #000000">00011:</span>         <span style="color: #008080">JFrame</span> frame <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">JFrame</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"CD Cover Viewer"</span><span style="color: #990000">);</span>
<span style="color: #000000">00012:</span>   <span style="color: #008080">JMenuBar</span> menuBar<span style="color: #990000">;</span>
<span style="color: #000000">00013:</span>   <span style="color: #008080">JMenu</span> menu<span style="color: #990000">;</span>
<span style="color: #000000">00014:</span>         <span style="color: #008080">Hashtable&lt;String,String&gt;</span> cds <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> Hashtable<span style="color: #990000">&lt;</span>String<span style="color: #990000">,</span>String<span style="color: #990000">&gt;();</span>
<span style="color: #000000">00015:</span>   
<span style="color: #000000">00016:</span>         <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span>String<span style="color: #990000">[]</span> args<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">throws</span></span> Exception <span style="color: #FF0000">{</span>
<span style="color: #000000">00017:</span>                 <span style="color: #008080">ImageProxyTestDrive</span> testDrive <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ImageProxyTestDrive</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00018:</span>         <span style="color: #FF0000">}</span>
<span style="color: #000000">00019:</span>   
<span style="color: #000000">00020:</span>         <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #000000">ImageProxyTestDrive</span></span><span style="color: #990000">()</span> <span style="font-weight: bold"><span style="color: #0000FF">throws</span></span> Exception<span style="color: #FF0000">{</span>
<span style="color: #000000">00021:</span>                 cds<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">put</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Ambient: Music for Airports"</span><span style="color: #990000">,</span><span style="color: #FF0000">"http://images.amazon.com/images/P/B000003S2K.01.LZZZZZZZ.jpg"</span><span style="color: #990000">);</span>
<span style="color: #000000">00022:</span>     cds<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">put</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Buddha Bar"</span><span style="color: #990000">,</span><span style="color: #FF0000">"http://images.amazon.com/images/P/B00009XBYK.01.LZZZZZZZ.jpg"</span><span style="color: #990000">);</span>
<span style="color: #000000">00023:</span>     cds<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">put</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Ima"</span><span style="color: #990000">,</span><span style="color: #FF0000">"http://images.amazon.com/images/P/B000005IRM.01.LZZZZZZZ.jpg"</span><span style="color: #990000">);</span>
<span style="color: #000000">00024:</span>     cds<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">put</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Karma"</span><span style="color: #990000">,</span><span style="color: #FF0000">"http://images.amazon.com/images/P/B000005DCB.01.LZZZZZZZ.gif"</span><span style="color: #990000">);</span>
<span style="color: #000000">00025:</span>     cds<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">put</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"MCMXC A.D."</span><span style="color: #990000">,</span><span style="color: #FF0000">"http://images.amazon.com/images/P/B000002URV.01.LZZZZZZZ.jpg"</span><span style="color: #990000">);</span>
<span style="color: #000000">00026:</span>     cds<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">put</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Northern Exposure"</span><span style="color: #990000">,</span><span style="color: #FF0000">"http://images.amazon.com/images/P/B000003SFN.01.LZZZZZZZ.jpg"</span><span style="color: #990000">);</span>
<span style="color: #000000">00027:</span>     cds<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">put</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Selected Ambient Works, Vol. 2"</span><span style="color: #990000">,</span><span style="color: #FF0000">"http://images.amazon.com/images/P/B000002MNZ.01.LZZZZZZZ.jpg"</span><span style="color: #990000">);</span>
<span style="color: #000000">00028:</span>     
<span style="color: #000000">00029:</span>                 <span style="color: #008080">URL</span> initialURL <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">URL</span></span><span style="color: #990000">((</span>String<span style="color: #990000">)</span>cds<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Selected Ambient Works, Vol. 2"</span><span style="color: #990000">));</span>
<span style="color: #000000">00030:</span>                 menuBar <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">JMenuBar</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00031:</span>                 menu <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">JMenu</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Favorite CDs"</span><span style="color: #990000">);</span>
<span style="color: #000000">00032:</span>     menuBar<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add</span></span><span style="color: #990000">(</span>menu<span style="color: #990000">);</span>
<span style="color: #000000">00033:</span>     frame<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setJMenuBar</span></span><span style="color: #990000">(</span>menuBar<span style="color: #990000">);</span>
<span style="color: #000000">00034:</span>     
<span style="color: #000000">00035:</span>                 <span style="font-weight: bold"><span style="color: #0000FF">for</span></span><span style="color: #990000">(</span><span style="color: #008080">Enumeration</span> e <span style="color: #990000">=</span> cds<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">keys</span></span><span style="color: #990000">();</span> e<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">hasMoreElements</span></span><span style="color: #990000">();)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00036:</span>                         <span style="color: #008080">String</span> name <span style="color: #990000">=</span> <span style="color: #990000">(</span>String<span style="color: #990000">)</span>e<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">nextElement</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00037:</span>       <span style="color: #008080">JMenuItem</span> menuItem <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">JMenuItem</span></span><span style="color: #990000">(</span>name<span style="color: #990000">);</span>
<span style="color: #000000">00038:</span>       menu<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add</span></span><span style="color: #990000">(</span>menuItem<span style="color: #990000">);</span> 
<span style="color: #000000">00039:</span>       menuItem<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addActionListener</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ActionListener</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00040:</span>           <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">actionPerformed</span></span><span style="color: #990000">(</span><span style="color: #008080">ActionEvent</span> event<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00041:</span>             imageComponent<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setIcon</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ImageProxy</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">getCDUrl</span></span><span style="color: #990000">(</span>event<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getActionCommand</span></span><span style="color: #990000">())));</span>
<span style="color: #000000">00042:</span>             frame<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">repaint</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00043:</span>           <span style="color: #FF0000">}</span>
<span style="color: #000000">00044:</span>         <span style="color: #FF0000">}</span><span style="color: #990000">);</span>
<span style="color: #000000">00045:</span>                 <span style="color: #FF0000">}</span>
<span style="color: #000000">00046:</span>                 
<span style="color: #000000">00047:</span>                 <span style="font-style: italic"><span style="color: #9A1900">// set up frame and menus</span></span>
<span style="color: #000000">00048:</span>     
<span style="color: #000000">00049:</span>                 <span style="color: #008080">Icon</span> icon <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ImageProxy</span></span><span style="color: #990000">(</span>initialURL<span style="color: #990000">);</span>
<span style="color: #000000">00050:</span>                 imageComponent <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ImageComponent</span></span><span style="color: #990000">(</span>icon<span style="color: #990000">);</span>
<span style="color: #000000">00051:</span>                 frame<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getContentPane</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">add</span></span><span style="color: #990000">(</span>imageComponent<span style="color: #990000">);</span>
<span style="color: #000000">00052:</span>                 frame<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setDefaultCloseOperation</span></span><span style="color: #990000">(</span>JFrame<span style="color: #990000">.</span>EXIT_ON_CLOSE<span style="color: #990000">);</span>
<span style="color: #000000">00053:</span>                 frame<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setSize</span></span><span style="color: #990000">(</span><span style="color: #993399">800</span><span style="color: #990000">,</span><span style="color: #993399">600</span><span style="color: #990000">);</span>
<span style="color: #000000">00054:</span>                 frame<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setVisible</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">);</span>
<span style="color: #000000">00055:</span>     
<span style="color: #000000">00056:</span>         <span style="color: #FF0000">}</span>
<span style="color: #000000">00057:</span>   
<span style="color: #000000">00058:</span>         <span style="color: #008080">URL</span> <span style="font-weight: bold"><span style="color: #000000">getCDUrl</span></span><span style="color: #990000">(</span><span style="color: #008080">String</span> name<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00059:</span>                 <span style="font-weight: bold"><span style="color: #0000FF">try</span></span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00060:</span>                         <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">URL</span></span><span style="color: #990000">((</span>String<span style="color: #990000">)</span>cds<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">(</span>name<span style="color: #990000">));</span>
<span style="color: #000000">00061:</span>                 <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">catch</span></span> <span style="color: #990000">(</span><span style="color: #008080">MalformedURLException</span> e<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00062:</span>                         e<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printStackTrace</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00063:</span>                         <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">;</span>
<span style="color: #000000">00064:</span>                 <span style="color: #FF0000">}</span>
<span style="color: #000000">00065:</span>         <span style="color: #FF0000">}</span>
<span style="color: #000000">00066:</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00067:</span> </tt></pre>

</td></tr></table>
</td></tr></table>
</blockquote>
        <p xmlns=""> </p><blockquote xmlns="">
<table width="97%">
<tr><td rowspan="1" colspan="1"><table width="100%" class="title"><tr><td rowspan="1" colspan="1"><b><a xmlns="http://www.w3.org/1999/xhtml" href="../code/html/headfirst/proxy/virtualproxy/ImageComponent_java.html">file:ImageComponent.java</a> [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/src/headfirst/proxy/virtualproxy/ImageComponent.java">source</a>] [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/doc-publicheadfirst/proxy/virtualproxy/ImageComponent.html">doc-public</a>] [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/doc-privateheadfirst/proxy/virtualproxy/ImageComponent.html">doc-private</a>]</b></td></tr></table></td></tr>
<tr><td rowspan="1" colspan="1"><table width="100%" class="code"><tr><td rowspan="1" colspan="1">

<pre xml:space="preserve"><tt><span style="color: #000000">00001:</span> <span style="font-weight: bold"><span style="color: #000080">package</span></span> headfirst<span style="color: #990000">.</span>proxy<span style="color: #990000">.</span>virtualproxy<span style="color: #990000">;</span>
<span style="color: #000000">00002:</span> 
<span style="color: #000000">00003:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> java<span style="color: #990000">.</span>awt<span style="color: #990000">.*;</span>
<span style="color: #000000">00004:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> javax<span style="color: #990000">.</span>swing<span style="color: #990000">.*;</span>
<span style="color: #000000">00005:</span> 
<span style="color: #000000">00006:</span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">ImageComponent</span> <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> JComponent <span style="color: #FF0000">{</span>
<span style="color: #000000">00007:</span>         <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #008080">Icon</span> icon<span style="color: #990000">;</span>
<span style="color: #000000">00008:</span> 
<span style="color: #000000">00009:</span>         <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #000000">ImageComponent</span></span><span style="color: #990000">(</span><span style="color: #008080">Icon</span> icon<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00010:</span>                 <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>icon <span style="color: #990000">=</span> icon<span style="color: #990000">;</span>
<span style="color: #000000">00011:</span>         <span style="color: #FF0000">}</span>
<span style="color: #000000">00012:</span> 
<span style="color: #000000">00013:</span>         <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">setIcon</span></span><span style="color: #990000">(</span><span style="color: #008080">Icon</span> icon<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00014:</span>                 <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>icon <span style="color: #990000">=</span> icon<span style="color: #990000">;</span>
<span style="color: #000000">00015:</span>         <span style="color: #FF0000">}</span>
<span style="color: #000000">00016:</span> 
<span style="color: #000000">00017:</span>         <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">paintComponent</span></span><span style="color: #990000">(</span><span style="color: #008080">Graphics</span> g<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00018:</span>                 <span style="font-weight: bold"><span style="color: #0000FF">super</span></span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">paintComponent</span></span><span style="color: #990000">(</span>g<span style="color: #990000">);</span>
<span style="color: #000000">00019:</span>                 <span style="color: #009900">int</span> w <span style="color: #990000">=</span> icon<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getIconWidth</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00020:</span>                 <span style="color: #009900">int</span> h <span style="color: #990000">=</span> icon<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getIconHeight</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00021:</span>                 <span style="color: #009900">int</span> x <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="color: #993399">800</span> <span style="color: #990000">-</span> w<span style="color: #990000">)/</span><span style="color: #993399">2</span><span style="color: #990000">;</span>
<span style="color: #000000">00022:</span>                 <span style="color: #009900">int</span> y <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="color: #993399">600</span> <span style="color: #990000">-</span> h<span style="color: #990000">)/</span><span style="color: #993399">2</span><span style="color: #990000">;</span>
<span style="color: #000000">00023:</span>                 icon<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">paintIcon</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> g<span style="color: #990000">,</span> x<span style="color: #990000">,</span> y<span style="color: #990000">);</span>
<span style="color: #000000">00024:</span>         <span style="color: #FF0000">}</span>
<span style="color: #000000">00025:</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00026:</span> </tt></pre>

</td></tr></table>
</td></tr></table>
</blockquote>
      <p> </p><table width="100%" class="title"><tr><td><span style="font-weight: bold; font-size: larger"><a name="slide003">Simulation: Active and Passive Objects</a></span><span style="font-weight: normal"><a href="class-07-003.html"> [3/13] </a></span></td></tr></table><p> </p>
        <p xmlns="">
          Agents act.
        </p>
        <p xmlns="">
          Agents know what they want to do.
        </p>
        <p xmlns="">
          One can model agents as finite automata.
        </p>
        <p xmlns="">
          Let's say I am implementing an airline reservation system.
          How do I do a simulation?
        </p>
        <p xmlns="">
          A passive view of a customer:
        </p>

<pre xmlns="" xml:space="preserve"><tt><span style="font-weight: bold"><span style="color: #0000FF">interface</span></span> <span style="color: #008080">Customer</span> <span style="color: #FF0000">{</span>
  <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">addFlight</span></span><span style="color: #990000">(</span><span style="color: #008080">Flight</span> f<span style="color: #990000">);</span>
  <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">removeFlight</span></span><span style="color: #990000">(</span><span style="color: #008080">Flight</span> f<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>
</tt></pre>

        <p xmlns="">
          A more active view:
        </p>

<pre xmlns="" xml:space="preserve"><tt><span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">interface</span></span> <span style="color: #008080">Agent</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">();</span>
<span style="color: #FF0000">}</span> 
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Main</span> <span style="color: #FF0000">{</span>
  <span style="color: #008080">List&lt;Agent&gt;</span> q <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> List<span style="color: #990000">&lt;</span>Agent<span style="color: #990000">&gt;();</span>
  <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i<span style="color: #990000">=</span><span style="color: #993399">0</span><span style="color: #990000">;</span> i<span style="color: #990000">&lt;</span>numSimulated<span style="color: #990000">;</span> i<span style="color: #990000">++)</span>
    q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">SimulatedCustomer</span></span><span style="color: #990000">());</span>
  <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i<span style="color: #990000">=</span><span style="color: #993399">0</span><span style="color: #990000">;</span> i<span style="color: #990000">&lt;</span>numHuman<span style="color: #990000">;</span> i<span style="color: #990000">++)</span>
    q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">HumanCustomer</span></span><span style="color: #990000">());</span>
  <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>currentTime<span style="color: #990000">=</span><span style="color: #993399">0</span><span style="color: #990000">;</span> currentTime<span style="color: #990000">&lt;</span>endTime<span style="color: #990000">;</span> currentTime<span style="color: #990000">+=</span>timeStep<span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #008080">Agent</span> a <span style="color: #990000">:</span> q<span style="color: #990000">)</span>
      a<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">();</span>
<span style="color: #FF0000">}</span>
</tt></pre>

        <p xmlns="">
          If we think of customers as "subscribing" to a time service:
        </p>

<pre xmlns="" xml:space="preserve"><tt><span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">interface</span></span> <span style="color: #008080">Agent</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">();</span>
<span style="color: #FF0000">}</span> 
<span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">interface</span></span> <span style="color: #008080">TimeServer</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">long</span> <span style="font-weight: bold"><span style="color: #000000">currentTime</span></span><span style="color: #990000">();</span>
  <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">add</span></span><span style="color: #990000">(</span><span style="color: #008080">Agent</span> thing<span style="color: #990000">);</span>
  <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> duration<span style="color: #990000">);</span> 
<span style="color: #FF0000">}</span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Main</span> <span style="color: #FF0000">{</span>
  <span style="color: #008080">TimeService</span> q <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">TimeService</span></span> <span style="color: #990000">();</span>
  <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i<span style="color: #990000">=</span><span style="color: #993399">0</span><span style="color: #990000">;</span> i<span style="color: #990000">&lt;</span>numSimulated<span style="color: #990000">;</span> i<span style="color: #990000">++)</span>
    q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">SimulatedCustomer</span></span><span style="color: #990000">());</span>
  <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i<span style="color: #990000">=</span><span style="color: #993399">0</span><span style="color: #990000">;</span> i<span style="color: #990000">&lt;</span>numHuman<span style="color: #990000">;</span> i<span style="color: #990000">++)</span>
    q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">HumanCustomer</span></span><span style="color: #990000">());</span>
  q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">(</span>duration<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>
</tt></pre>

        <p xmlns="">
          With "sparse" time you use a priority queue:
        </p>

<pre xmlns="" xml:space="preserve"><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Main</span> <span style="color: #FF0000">{</span>
  <span style="color: #008080">TimeServer</span> q <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">TimeServer</span></span><span style="color: #990000">();</span>
  <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i<span style="color: #990000">=</span><span style="color: #993399">0</span><span style="color: #990000">;</span> i<span style="color: #990000">&lt;</span>numSimulated<span style="color: #990000">;</span> i<span style="color: #990000">++)</span>
    q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span>q<span style="color: #990000">.</span>currentTime<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">SimulatedCustomer</span></span><span style="color: #990000">());</span>
  <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i<span style="color: #990000">=</span><span style="color: #993399">0</span><span style="color: #990000">;</span> i<span style="color: #990000">&lt;</span>numHuman<span style="color: #990000">;</span> i<span style="color: #990000">++)</span>
    q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span>q<span style="color: #990000">.</span>currentTime<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">HumanCustomer</span></span><span style="color: #990000">());</span>
  q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">(</span>duration<span style="color: #990000">);</span> 
<span style="color: #FF0000">}</span>
<span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">interface</span></span> <span style="color: #008080">TimeServer</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">long</span> <span style="font-weight: bold"><span style="color: #000000">currentTime</span></span><span style="color: #990000">();</span>
  <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span><span style="color: #009900">long</span> time<span style="color: #990000">,</span> <span style="color: #008080">Agent</span> thing<span style="color: #990000">);</span>
  <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> duration<span style="color: #990000">);</span> 
<span style="color: #FF0000">}</span>
<span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">interface</span></span> <span style="color: #008080">Agent</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">();</span>
<span style="color: #FF0000">}</span> 
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">SimulatedCustomer</span> <span style="font-weight: bold"><span style="color: #0000FF">implements</span></span> Agent <span style="color: #FF0000">{</span>
  <span style="color: #009900">int</span> state<span style="color: #990000">;</span>
  <span style="font-weight: bold"><span style="color: #000000">SimulatedCustomer</span></span><span style="color: #990000">(</span><span style="color: #008080">TimeServer</span> q<span style="color: #990000">)</span> <span style="color: #FF0000">{</span> <span style="color: #990000">...</span> <span style="color: #FF0000">}</span>
  <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">switch</span></span> <span style="color: #990000">(</span>state<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
      <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #990000">...</span>
        <span style="color: #990000">...</span>
        q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span>q<span style="color: #990000">.</span>currentTime <span style="color: #990000">+</span> <span style="color: #993399">500</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
      <span style="color: #990000">...</span>
    <span style="color: #FF0000">}</span>
  <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">HumanCustomer</span> <span style="font-weight: bold"><span style="color: #0000FF">implements</span></span> Agent <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #000000">HumanCustomer</span></span><span style="color: #990000">(</span><span style="color: #008080">TimeServer</span> q<span style="color: #990000">,</span> <span style="color: #008080">UI</span> ui<span style="color: #990000">)</span> <span style="color: #FF0000">{</span> <span style="color: #990000">...</span> <span style="color: #FF0000">}</span>
  <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
    <span style="font-style: italic"><span style="color: #9A1900">// create a menu whose options end with:</span></span>
    <span style="font-style: italic"><span style="color: #9A1900">// q.enqueue(q.currentTime + 500, this);</span></span>
    <span style="color: #990000">...</span>
    ui<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">displayMenu</span></span><span style="color: #990000">(</span>menu<span style="color: #990000">);</span>
  <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>
</tt></pre>

      <p> </p><table width="100%" class="title"><tr><td><span style="font-weight: bold; font-size: larger"><a name="slide004">Simulation: Example 1</a></span><span style="font-weight: normal"><a href="class-07-004.html"> [4/13] </a></span></td></tr></table><p> </p>
        <p xmlns=""> </p><blockquote xmlns="">
<table width="97%">
<tr><td rowspan="1" colspan="1"><table width="100%" class="title"><tr><td rowspan="1" colspan="1"><b><a xmlns="http://www.w3.org/1999/xhtml" href="../code/html/agent/one/Main_java.html">file:Main.java</a> [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/src/agent/one/Main.java">source</a>] [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/doc-publicagent/one/Main.html">doc-public</a>] [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/doc-privateagent/one/Main.html">doc-private</a>]</b></td></tr></table></td></tr>
<tr><td rowspan="1" colspan="1"><table width="100%" class="code"><tr><td rowspan="1" colspan="1">

<pre xml:space="preserve"><tt><span style="color: #000000">00001:</span> <span style="font-weight: bold"><span style="color: #000080">package</span></span> agent<span style="color: #990000">.</span>one<span style="color: #990000">;</span>
<span style="color: #000000">00002:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> agent<span style="color: #990000">.</span>Agent<span style="color: #990000">;</span>
<span style="color: #000000">00003:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> agent<span style="color: #990000">.</span>TimeServer<span style="color: #990000">;</span>
<span style="color: #000000">00004:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> agent<span style="color: #990000">.</span>TimeServerLinked<span style="color: #990000">;</span>
<span style="color: #000000">00005:</span> 
<span style="color: #000000">00006:</span> <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Main</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00007:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span>String<span style="color: #990000">[]</span> args<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00008:</span>     <span style="color: #008080">TimeServer</span> time <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">TimeServerLinked</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00009:</span>     <span style="color: #008080">Agent</span> a <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Tiger</span></span><span style="color: #990000">(</span>time<span style="color: #990000">);</span>
<span style="color: #000000">00010:</span>     time<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">,</span>a<span style="color: #990000">);</span>
<span style="color: #000000">00011:</span>     time<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">(</span><span style="color: #993399">100</span><span style="color: #990000">);</span>
<span style="color: #000000">00012:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00013:</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00014:</span> 
<span style="color: #000000">00015:</span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Tiger</span> <span style="font-weight: bold"><span style="color: #0000FF">implements</span></span> Agent <span style="color: #FF0000">{</span>
<span style="color: #000000">00016:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> TimeServer _time<span style="color: #990000">;</span>
<span style="color: #000000">00017:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #000000">Tiger</span></span><span style="color: #990000">(</span><span style="color: #008080">TimeServer</span> time<span style="color: #990000">)</span> <span style="color: #FF0000">{</span> _time <span style="color: #990000">=</span> time<span style="color: #990000">;</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00018:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00019:</span>     System<span style="color: #990000">.</span>out<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">println</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"It's "</span> <span style="color: #990000">+</span> _time<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">currentTime</span></span><span style="color: #990000">()</span> <span style="color: #990000">+</span> <span style="color: #FF0000">" and I'm alive!"</span><span style="color: #990000">);</span>
<span style="color: #000000">00020:</span>     _time<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span><span style="color: #993399">10</span><span style="color: #990000">+</span>_time<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">currentTime</span></span><span style="color: #990000">(),</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">);</span>
<span style="color: #000000">00021:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00022:</span> <span style="color: #FF0000">}</span>  
<span style="color: #000000">00023:</span> </tt></pre>

</td></tr></table>
</td></tr></table>
</blockquote>
      <p> </p><table width="100%" class="title"><tr><td><span style="font-weight: bold; font-size: larger"><a name="slide005">Simulation: Example 2</a></span><span style="font-weight: normal"><a href="class-07-005.html"> [5/13] </a></span></td></tr></table><p> </p>
        <p xmlns=""> </p><blockquote xmlns="">
<table width="97%">
<tr><td rowspan="1" colspan="1"><table width="100%" class="title"><tr><td rowspan="1" colspan="1"><b><a xmlns="http://www.w3.org/1999/xhtml" href="../code/html/agent/two/Main_java.html">file:Main.java</a> [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/src/agent/two/Main.java">source</a>] [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/doc-publicagent/two/Main.html">doc-public</a>] [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/doc-privateagent/two/Main.html">doc-private</a>]</b></td></tr></table></td></tr>
<tr><td rowspan="1" colspan="1"><table width="100%" class="code"><tr><td rowspan="1" colspan="1">

<pre xml:space="preserve"><tt><span style="color: #000000">00001:</span> <span style="font-weight: bold"><span style="color: #000080">package</span></span> agent<span style="color: #990000">.</span>two<span style="color: #990000">;</span>
<span style="color: #000000">00002:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> agent<span style="color: #990000">.</span>Agent<span style="color: #990000">;</span>
<span style="color: #000000">00003:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> agent<span style="color: #990000">.</span>TimeServer<span style="color: #990000">;</span>
<span style="color: #000000">00004:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> agent<span style="color: #990000">.</span>TimeServerLinked<span style="color: #990000">;</span>
<span style="color: #000000">00005:</span> 
<span style="color: #000000">00006:</span> <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Main</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00007:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span>String<span style="color: #990000">[]</span> args<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00008:</span>     <span style="color: #008080">World</span> w <span style="color: #990000">=</span> World<span style="color: #990000">.</span>instance<span style="color: #990000">;</span>
<span style="color: #000000">00009:</span>     <span style="color: #008080">Agent</span> a <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Tiger</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00010:</span>     w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">time</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">,</span>a<span style="color: #990000">);</span>
<span style="color: #000000">00011:</span>     w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">time</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">(</span><span style="color: #993399">100</span><span style="color: #990000">);</span>
<span style="color: #000000">00012:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00013:</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00014:</span> 
<span style="color: #000000">00015:</span> <span style="font-weight: bold"><span style="color: #0000FF">interface</span></span> <span style="color: #008080">World</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00016:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">final</span></span> <span style="color: #008080">World</span> instance <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">WorldObj</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00017:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #008080">TimeServer</span> <span style="font-weight: bold"><span style="color: #000000">time</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00018:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> Object<span style="color: #990000">[][]</span> <span style="font-weight: bold"><span style="color: #000000">space</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00019:</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00020:</span> 
<span style="color: #000000">00021:</span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">WorldObj</span> <span style="font-weight: bold"><span style="color: #0000FF">implements</span></span> World <span style="color: #FF0000">{</span>
<span style="color: #000000">00022:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> TimeServer _time <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">TimeServerLinked</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00023:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> Object<span style="color: #990000">[][]</span> _space <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> Object<span style="color: #990000">[</span><span style="color: #993399">100</span><span style="color: #990000">][</span><span style="color: #993399">100</span><span style="color: #990000">];</span>
<span style="color: #000000">00024:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #008080">TimeServer</span> <span style="font-weight: bold"><span style="color: #000000">time</span></span><span style="color: #990000">()</span>  <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> _time<span style="color: #990000">;</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00025:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> Object<span style="color: #990000">[][]</span> <span style="font-weight: bold"><span style="color: #000000">space</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> _space<span style="color: #990000">;</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00026:</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00027:</span>   
<span style="color: #000000">00028:</span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Tiger</span> <span style="font-weight: bold"><span style="color: #0000FF">implements</span></span> Agent <span style="color: #FF0000">{</span>
<span style="color: #000000">00029:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00030:</span>     <span style="color: #008080">World</span> w <span style="color: #990000">=</span> World<span style="color: #990000">.</span>instance<span style="color: #990000">;</span>
<span style="color: #000000">00031:</span>     System<span style="color: #990000">.</span>out<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">println</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"It's "</span> <span style="color: #990000">+</span> w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">time</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">currentTime</span></span><span style="color: #990000">()</span> <span style="color: #990000">+</span> <span style="color: #FF0000">" and I'm alive!"</span><span style="color: #990000">);</span>
<span style="color: #000000">00032:</span>     w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">time</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span><span style="color: #993399">10</span><span style="color: #990000">+</span>w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">time</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">currentTime</span></span><span style="color: #990000">(),</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">);</span>
<span style="color: #000000">00033:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00034:</span> <span style="color: #FF0000">}</span>  
<span style="color: #000000">00035:</span> </tt></pre>

</td></tr></table>
</td></tr></table>
</blockquote>
      <p> </p><table width="100%" class="title"><tr><td><span style="font-weight: bold; font-size: larger"><a name="slide006">Simulation: Example 3</a></span><span style="font-weight: normal"><a href="class-07-006.html"> [6/13] </a></span></td></tr></table><p> </p>
        <p xmlns=""> </p><blockquote xmlns="">
<table width="97%">
<tr><td rowspan="1" colspan="1"><table width="100%" class="title"><tr><td rowspan="1" colspan="1"><b><a xmlns="http://www.w3.org/1999/xhtml" href="../code/html/agent/three/Main_java.html">file:Main.java</a> [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/src/agent/three/Main.java">source</a>] [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/doc-publicagent/three/Main.html">doc-public</a>] [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/doc-privateagent/three/Main.html">doc-private</a>]</b></td></tr></table></td></tr>
<tr><td rowspan="1" colspan="1"><table width="100%" class="code"><tr><td rowspan="1" colspan="1">

<pre xml:space="preserve"><tt><span style="color: #000000">00001:</span> <span style="font-weight: bold"><span style="color: #000080">package</span></span> agent<span style="color: #990000">.</span>three<span style="color: #990000">;</span>
<span style="color: #000000">00002:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> agent<span style="color: #990000">.</span>Agent<span style="color: #990000">;</span>
<span style="color: #000000">00003:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> agent<span style="color: #990000">.</span>TimeServer<span style="color: #990000">;</span>
<span style="color: #000000">00004:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> agent<span style="color: #990000">.</span>TimeServerLinked<span style="color: #990000">;</span>
<span style="color: #000000">00005:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> java<span style="color: #990000">.</span>util<span style="color: #990000">.</span>Observer<span style="color: #990000">;</span>
<span style="color: #000000">00006:</span> 
<span style="color: #000000">00007:</span> <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Main</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00008:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span>String<span style="color: #990000">[]</span> args<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00009:</span>     <span style="color: #008080">World</span> w <span style="color: #990000">=</span> World<span style="color: #990000">.</span>instance<span style="color: #990000">;</span>
<span style="color: #000000">00010:</span>     <span style="color: #008080">Agent</span> a <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Tiger</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00011:</span>     w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">,</span>a<span style="color: #990000">);</span>
<span style="color: #000000">00012:</span>     w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">set</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">,</span>a<span style="color: #990000">);</span>
<span style="color: #000000">00013:</span>     w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">(</span><span style="color: #993399">100</span><span style="color: #990000">);</span>
<span style="color: #000000">00014:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00015:</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00016:</span> 
<span style="color: #000000">00017:</span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Util</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00018:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #000000">Util</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{}</span>
<span style="color: #000000">00019:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">final</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">long</span> SEED <span style="color: #990000">=</span> <span style="color: #993399">2497</span><span style="color: #990000">;</span>
<span style="color: #000000">00020:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">final</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> java<span style="color: #990000">.</span>util<span style="color: #990000">.</span>Random _r <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> java<span style="color: #990000">.</span>util<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Random</span></span><span style="color: #990000">(</span>SEED<span style="color: #990000">);</span>
<span style="color: #000000">00021:</span>   <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">random</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> n<span style="color: #990000">)</span> <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> _r<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">nextInt</span></span><span style="color: #990000">(</span>n<span style="color: #990000">);</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00022:</span>   <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">boolean</span> <span style="font-weight: bold"><span style="color: #000000">randomBoolean</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> _r<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">nextBoolean</span></span><span style="color: #990000">();</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00023:</span> <span style="color: #FF0000">}</span>  
<span style="color: #000000">00024:</span> 
<span style="color: #000000">00025:</span> <span style="font-weight: bold"><span style="color: #0000FF">interface</span></span> <span style="color: #008080">World</span> <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> TimeServer <span style="color: #FF0000">{</span>
<span style="color: #000000">00026:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">final</span></span> <span style="color: #008080">World</span> instance <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">WorldObj</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00027:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">maxx</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00028:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">maxy</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00029:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #008080">Object</span> <span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> i<span style="color: #990000">,</span> <span style="color: #009900">int</span> j<span style="color: #990000">);</span>
<span style="color: #000000">00030:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">set</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> i<span style="color: #990000">,</span> <span style="color: #009900">int</span> j<span style="color: #990000">,</span> <span style="color: #008080">Object</span> a<span style="color: #990000">);</span>
<span style="color: #000000">00031:</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00032:</span> 
<span style="color: #000000">00033:</span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">WorldObj</span> <span style="font-weight: bold"><span style="color: #0000FF">implements</span></span> World <span style="color: #FF0000">{</span>
<span style="color: #000000">00034:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">final</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">int</span> MAXX <span style="color: #990000">=</span> <span style="color: #993399">100</span><span style="color: #990000">;</span>
<span style="color: #000000">00035:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">final</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">int</span> MAXY <span style="color: #990000">=</span> <span style="color: #993399">100</span><span style="color: #990000">;</span>
<span style="color: #000000">00036:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> TimeServer _time <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">TimeServerLinked</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00037:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> Object<span style="color: #990000">[][]</span> _space <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> Object<span style="color: #990000">[</span>MAXX<span style="color: #990000">][</span>MAXY<span style="color: #990000">];</span>
<span style="color: #000000">00038:</span> 
<span style="color: #000000">00039:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">maxx</span></span><span style="color: #990000">()</span>                      <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> MAXX<span style="color: #990000">;</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00040:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">maxy</span></span><span style="color: #990000">()</span>                      <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> MAXY<span style="color: #990000">;</span> <span style="color: #FF0000">}</span>     
<span style="color: #000000">00041:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #008080">Object</span> <span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> x<span style="color: #990000">,</span> <span style="color: #009900">int</span> y<span style="color: #990000">)</span>        <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> _space<span style="color: #990000">[</span>x<span style="color: #990000">%</span>MAXX<span style="color: #990000">][</span>y<span style="color: #990000">%</span>MAXY<span style="color: #990000">];</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00042:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">set</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> x<span style="color: #990000">,</span> <span style="color: #009900">int</span> y<span style="color: #990000">,</span> <span style="color: #008080">Object</span> a<span style="color: #990000">)</span><span style="color: #FF0000">{</span> _space<span style="color: #990000">[</span>x<span style="color: #990000">%</span>MAXX<span style="color: #990000">][</span>y<span style="color: #990000">%</span>MAXY<span style="color: #990000">]</span> <span style="color: #990000">=</span> a<span style="color: #990000">;</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00043:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">double</span> <span style="font-weight: bold"><span style="color: #000000">currentTime</span></span><span style="color: #990000">()</span>            <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> _time<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">currentTime</span></span><span style="color: #990000">();</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00044:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span><span style="color: #009900">double</span> t<span style="color: #990000">,</span> <span style="color: #008080">Agent</span> a<span style="color: #990000">)</span> <span style="color: #FF0000">{</span> _time<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span>t<span style="color: #990000">,</span>a<span style="color: #990000">);</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00045:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">(</span><span style="color: #009900">double</span> d<span style="color: #990000">)</span>              <span style="color: #FF0000">{</span> _time<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">(</span>d<span style="color: #990000">);</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00046:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">addObserver</span></span><span style="color: #990000">(</span><span style="color: #008080">Observer</span> o<span style="color: #990000">)</span>    <span style="color: #FF0000">{</span> _time<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addObserver</span></span><span style="color: #990000">(</span>o<span style="color: #990000">);</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00047:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">deleteObserver</span></span><span style="color: #990000">(</span><span style="color: #008080">Observer</span> o<span style="color: #990000">)</span> <span style="color: #FF0000">{</span> _time<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">deleteObserver</span></span><span style="color: #990000">(</span>o<span style="color: #990000">);</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00048:</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00049:</span>   
<span style="color: #000000">00050:</span> <span style="font-style: italic"><span style="color: #9A1900">/* </span></span><span style="font-weight: bold"><span style="background-color: #66FFFF">BUG</span></span><span style="font-style: italic"><span style="color: #9A1900">S HERE */</span></span>
<span style="color: #000000">00051:</span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Tiger</span> <span style="font-weight: bold"><span style="color: #0000FF">implements</span></span> Agent <span style="color: #FF0000">{</span>
<span style="color: #000000">00052:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">int</span> _x<span style="color: #990000">;</span>
<span style="color: #000000">00053:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">int</span> _y<span style="color: #990000">;</span>
<span style="color: #000000">00054:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> World _w <span style="color: #990000">=</span> World<span style="color: #990000">.</span>instance<span style="color: #990000">;</span>
<span style="color: #000000">00055:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">moveRandom</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00056:</span>     _w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">set</span></span><span style="color: #990000">(</span>_x<span style="color: #990000">,</span>_y<span style="color: #990000">,</span><span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">);</span>
<span style="color: #000000">00057:</span>     <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>Util<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">randomBoolean</span></span><span style="color: #990000">())</span> <span style="color: #FF0000">{</span> _x <span style="color: #990000">=</span> <span style="color: #990000">(</span>_x<span style="color: #990000">+</span><span style="color: #993399">1</span><span style="color: #990000">)%</span>_w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">maxx</span></span><span style="color: #990000">();</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00058:</span>     <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>Util<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">randomBoolean</span></span><span style="color: #990000">())</span> <span style="color: #FF0000">{</span> _y <span style="color: #990000">=</span> <span style="color: #990000">(</span>_y<span style="color: #990000">+</span><span style="color: #993399">1</span><span style="color: #990000">)%</span>_w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">maxy</span></span><span style="color: #990000">();</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00059:</span>     _w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">set</span></span><span style="color: #990000">(</span>_x<span style="color: #990000">,</span>_y<span style="color: #990000">,</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">);</span>
<span style="color: #000000">00060:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00061:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00062:</span>     <span style="font-weight: bold"><span style="color: #000000">moveRandom</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00063:</span>     System<span style="color: #990000">.</span>out<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">println</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"It's "</span> <span style="color: #990000">+</span> _w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">currentTime</span></span><span style="color: #990000">()</span> <span style="color: #990000">+</span> <span style="color: #FF0000">" and I'm alive at ("</span> <span style="color: #990000">+</span> _x <span style="color: #990000">+</span> <span style="color: #FF0000">","</span> <span style="color: #990000">+</span> _y <span style="color: #990000">+</span> <span style="color: #FF0000">")!"</span><span style="color: #990000">);</span>
<span style="color: #000000">00064:</span>     _w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span><span style="color: #993399">10</span><span style="color: #990000">+</span>_w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">currentTime</span></span><span style="color: #990000">(),</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">);</span>
<span style="color: #000000">00065:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00066:</span>   
<span style="color: #000000">00067:</span> <span style="color: #FF0000">}</span>  
<span style="color: #000000">00068:</span> </tt></pre>

</td></tr></table>
</td></tr></table>
</blockquote>
      <p> </p><table width="100%" class="title"><tr><td><span style="font-weight: bold; font-size: larger"><a name="slide007">Simulation: Example 4</a></span><span style="font-weight: normal"><a href="class-07-007.html"> [7/13] </a></span></td></tr></table><p> </p>
        <p xmlns=""> </p><blockquote xmlns="">
<table width="97%">
<tr><td rowspan="1" colspan="1"><table width="100%" class="title"><tr><td rowspan="1" colspan="1"><b><a xmlns="http://www.w3.org/1999/xhtml" href="../code/html/agent/four/Main_java.html">file:Main.java</a> [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/src/agent/four/Main.java">source</a>] [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/doc-publicagent/four/Main.html">doc-public</a>] [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/doc-privateagent/four/Main.html">doc-private</a>]</b></td></tr></table></td></tr>
<tr><td rowspan="1" colspan="1"><table width="100%" class="code"><tr><td rowspan="1" colspan="1">

<pre xml:space="preserve"><tt><span style="color: #000000">00001:</span> <span style="font-weight: bold"><span style="color: #000080">package</span></span> agent<span style="color: #990000">.</span>four<span style="color: #990000">;</span>
<span style="color: #000000">00002:</span> 
<span style="color: #000000">00003:</span> <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Main</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00004:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span>String<span style="color: #990000">[]</span> args<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00005:</span>     <span style="color: #008080">World</span> w <span style="color: #990000">=</span> WorldF<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">instance</span></span><span style="color: #990000">(</span><span style="color: #993399">100</span><span style="color: #990000">,</span><span style="color: #993399">100</span><span style="color: #990000">);</span>
<span style="color: #000000">00006:</span>     <span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #000000">00007:</span>     <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span>i<span style="color: #990000">&lt;</span><span style="color: #993399">20</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00008:</span>       <span style="font-weight: bold"><span style="color: #0000FF">try</span></span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00009:</span>         <span style="color: #008080">Tiger</span> t <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> Tiger
<span style="color: #000000">00010:</span>           <span style="color: #990000">(</span>Integer<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">toString</span></span><span style="color: #990000">(</span>i<span style="color: #990000">),</span> Util<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">random</span></span><span style="color: #990000">(</span>w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">maxx</span></span><span style="color: #990000">()),</span> Util<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">random</span></span><span style="color: #990000">(</span>w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">maxy</span></span><span style="color: #990000">()));</span>
<span style="color: #000000">00011:</span>         i<span style="color: #990000">++;</span>
<span style="color: #000000">00012:</span>       <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">catch</span></span> <span style="color: #990000">(</span><span style="color: #008080">SpaceOccupiedException</span> e<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00013:</span>       <span style="color: #FF0000">}</span>
<span style="color: #000000">00014:</span>     <span style="color: #FF0000">}</span>
<span style="color: #000000">00015:</span>     w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">(</span><span style="color: #993399">1000</span><span style="color: #990000">);</span>
<span style="color: #000000">00016:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00017:</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00018:</span> 
<span style="color: #000000">00019:</span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Util</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00020:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #000000">Util</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{}</span>
<span style="color: #000000">00021:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">final</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">long</span> SEED <span style="color: #990000">=</span> <span style="color: #993399">2497</span><span style="color: #990000">;</span>
<span style="color: #000000">00022:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">final</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> java<span style="color: #990000">.</span>util<span style="color: #990000">.</span>Random _r <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> java<span style="color: #990000">.</span>util<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Random</span></span><span style="color: #990000">(</span>SEED<span style="color: #990000">);</span>
<span style="color: #000000">00023:</span>   <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">random</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> n<span style="color: #990000">)</span> <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> _r<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">nextInt</span></span><span style="color: #990000">(</span>n<span style="color: #990000">);</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00024:</span>   <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">boolean</span> <span style="font-weight: bold"><span style="color: #000000">randomBoolean</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> _r<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">nextBoolean</span></span><span style="color: #990000">();</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00025:</span> <span style="color: #FF0000">}</span>  
<span style="color: #000000">00026:</span> 
<span style="color: #000000">00027:</span> <span style="font-weight: bold"><span style="color: #0000FF">interface</span></span> <span style="color: #008080">World</span> <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> TimeServer <span style="color: #FF0000">{</span>
<span style="color: #000000">00028:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">maxx</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00029:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">maxy</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00030:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #008080">Visible</span> <span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> i<span style="color: #990000">,</span> <span style="color: #009900">int</span> j<span style="color: #990000">);</span>
<span style="color: #000000">00031:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">boolean</span> <span style="font-weight: bold"><span style="color: #000000">set</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> i<span style="color: #990000">,</span> <span style="color: #009900">int</span> j<span style="color: #990000">,</span> <span style="color: #008080">Visible</span> a<span style="color: #990000">);</span>
<span style="color: #000000">00032:</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00033:</span> 
<span style="color: #000000">00034:</span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">WorldF</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00035:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> World _W<span style="color: #990000">;</span>
<span style="color: #000000">00036:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">World</span> <span style="font-weight: bold"><span style="color: #000000">instance</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> maxx<span style="color: #990000">,</span> <span style="color: #009900">int</span> maxy<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00037:</span>     <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>_W <span style="color: #990000">!=</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">)</span>
<span style="color: #000000">00038:</span>       <span style="font-weight: bold"><span style="color: #0000FF">throw</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">IllegalStateException</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00039:</span>     _W <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">WorldObj</span></span><span style="color: #990000">(</span>maxx<span style="color: #990000">,</span> maxy<span style="color: #990000">);</span>
<span style="color: #000000">00040:</span>     <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> _W<span style="color: #990000">;</span>
<span style="color: #000000">00041:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00042:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">World</span> <span style="font-weight: bold"><span style="color: #000000">instance</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00043:</span>     <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>_W <span style="color: #990000">==</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">)</span>
<span style="color: #000000">00044:</span>       <span style="font-weight: bold"><span style="color: #0000FF">throw</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">IllegalStateException</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00045:</span>     <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> _W<span style="color: #990000">;</span>
<span style="color: #000000">00046:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00047:</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00048:</span> 
<span style="color: #000000">00049:</span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">WorldObj</span> <span style="font-weight: bold"><span style="color: #0000FF">implements</span></span> World <span style="color: #FF0000">{</span>
<span style="color: #000000">00050:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">final</span></span> <span style="color: #009900">int</span> _maxx<span style="color: #990000">;</span>
<span style="color: #000000">00051:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">final</span></span> <span style="color: #009900">int</span> _maxy<span style="color: #990000">;</span>
<span style="color: #000000">00052:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">final</span></span> TimeServer _time<span style="color: #990000">;</span>
<span style="color: #000000">00053:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">final</span></span> Visible<span style="color: #990000">[][]</span> _space<span style="color: #990000">;</span>
<span style="color: #000000">00054:</span> 
<span style="color: #000000">00055:</span>   <span style="font-weight: bold"><span style="color: #000000">WorldObj</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> maxx<span style="color: #990000">,</span> <span style="color: #009900">int</span> maxy<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00056:</span>     _maxx <span style="color: #990000">=</span> maxx<span style="color: #990000">;</span>
<span style="color: #000000">00057:</span>     _maxy <span style="color: #990000">=</span> maxy<span style="color: #990000">;</span>
<span style="color: #000000">00058:</span>     _time <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">TimeServerLinked</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00059:</span>     _space <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> Visible<span style="color: #990000">[</span>_maxx<span style="color: #990000">][</span>_maxy<span style="color: #990000">];</span>
<span style="color: #000000">00060:</span>     <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> x <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> x <span style="color: #990000">&lt;</span> _maxx<span style="color: #990000">;</span> x<span style="color: #990000">++</span> <span style="color: #990000">)</span>
<span style="color: #000000">00061:</span>       <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> y <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> y <span style="color: #990000">&lt;</span> _maxy<span style="color: #990000">;</span> y<span style="color: #990000">++</span> <span style="color: #990000">)</span>
<span style="color: #000000">00062:</span>         _space<span style="color: #990000">[</span>x<span style="color: #990000">][</span>y<span style="color: #990000">]</span> <span style="color: #990000">=</span> NullVisible<span style="color: #990000">.</span>instance<span style="color: #990000">;</span>
<span style="color: #000000">00063:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00064:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">maxx</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> _maxx<span style="color: #990000">;</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00065:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">maxy</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> _maxy<span style="color: #990000">;</span> <span style="color: #FF0000">}</span>     
<span style="color: #000000">00066:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #008080">Visible</span> <span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> x<span style="color: #990000">,</span> <span style="color: #009900">int</span> y<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00067:</span>     <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> _space<span style="color: #990000">[(</span>x<span style="color: #990000">+</span>_maxx<span style="color: #990000">)%</span>_maxx<span style="color: #990000">][(</span>y<span style="color: #990000">+</span>_maxy<span style="color: #990000">)%</span>_maxy<span style="color: #990000">];</span>
<span style="color: #000000">00068:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00069:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">boolean</span> <span style="font-weight: bold"><span style="color: #000000">set</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> x<span style="color: #990000">,</span> <span style="color: #009900">int</span> y<span style="color: #990000">,</span> <span style="color: #008080">Visible</span> a<span style="color: #990000">)</span><span style="color: #FF0000">{</span>
<span style="color: #000000">00070:</span>     <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>a <span style="color: #990000">==</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00071:</span>       a <span style="color: #990000">=</span> NullVisible<span style="color: #990000">.</span>instance<span style="color: #990000">;</span>
<span style="color: #000000">00072:</span>     <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">(</span>x<span style="color: #990000">,</span>y<span style="color: #990000">)</span> <span style="color: #990000">!=</span> NullVisible<span style="color: #990000">.</span>instance<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00073:</span>       <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
<span style="color: #000000">00074:</span>     <span style="color: #FF0000">}</span>
<span style="color: #000000">00075:</span>     _space<span style="color: #990000">[(</span>x<span style="color: #990000">+</span>_maxx<span style="color: #990000">)%</span>_maxx<span style="color: #990000">][(</span>y<span style="color: #990000">+</span>_maxy<span style="color: #990000">)%</span>_maxy<span style="color: #990000">]</span> <span style="color: #990000">=</span> a<span style="color: #990000">;</span>
<span style="color: #000000">00076:</span>     <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">;</span>
<span style="color: #000000">00077:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00078:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">long</span> <span style="font-weight: bold"><span style="color: #000000">currentTime</span></span><span style="color: #990000">()</span>              <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> _time<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">currentTime</span></span><span style="color: #990000">();</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00079:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span><span style="color: #009900">long</span> t<span style="color: #990000">,</span> <span style="color: #008080">Agent</span> a<span style="color: #990000">)</span>   <span style="color: #FF0000">{</span> _time<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span>t<span style="color: #990000">,</span>a<span style="color: #990000">);</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00080:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> d<span style="color: #990000">)</span>                 <span style="color: #FF0000">{</span> _time<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">(</span>d<span style="color: #990000">);</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00081:</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00082:</span> 
<span style="color: #000000">00083:</span> <span style="font-weight: bold"><span style="color: #0000FF">interface</span></span> <span style="color: #008080">Visible</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00084:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">final</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">int</span> NULL <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #000000">00085:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">final</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">int</span> TIGER <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
<span style="color: #000000">00086:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">type</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00087:</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00088:</span>   
<span style="color: #000000">00089:</span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">NullVisible</span> <span style="font-weight: bold"><span style="color: #0000FF">implements</span></span> Visible <span style="color: #FF0000">{</span>
<span style="color: #000000">00090:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #000000">NullVisible</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{}</span>
<span style="color: #000000">00091:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">final</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">Visible</span> instance <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">NullVisible</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00092:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">type</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> Visible<span style="color: #990000">.</span>NULL<span style="color: #990000">;</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00093:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #008080">String</span> <span style="font-weight: bold"><span style="color: #000000">toString</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"Null"</span><span style="color: #990000">;</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00094:</span> <span style="color: #FF0000">}</span>  
<span style="color: #000000">00095:</span> 
<span style="color: #000000">00096:</span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">SpaceOccupiedException</span> <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> RuntimeException <span style="color: #FF0000">{</span>
<span style="color: #000000">00097:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">final</span></span> <span style="color: #009900">long</span> serialVersionUID <span style="color: #990000">=</span> <span style="color: #993399">2008L</span><span style="color: #990000">;</span>
<span style="color: #000000">00098:</span> <span style="color: #FF0000">}</span><span style="color: #990000">;</span>
<span style="color: #000000">00099:</span> 
<span style="color: #000000">00100:</span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Tiger</span> <span style="font-weight: bold"><span style="color: #0000FF">implements</span></span> Agent<span style="color: #990000">,</span> Visible <span style="color: #FF0000">{</span>
<span style="color: #000000">00101:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> String _name<span style="color: #990000">;</span>
<span style="color: #000000">00102:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">int</span> _x<span style="color: #990000">;</span>
<span style="color: #000000">00103:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">int</span> _y<span style="color: #990000">;</span>
<span style="color: #000000">00104:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> World _w <span style="color: #990000">=</span> WorldF<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">instance</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00105:</span> 
<span style="color: #000000">00106:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #000000">Tiger</span></span><span style="color: #990000">(</span><span style="color: #008080">String</span> name<span style="color: #990000">,</span> <span style="color: #009900">int</span> x<span style="color: #990000">,</span> <span style="color: #009900">int</span> y<span style="color: #990000">)</span>
<span style="color: #000000">00107:</span>     <span style="font-weight: bold"><span style="color: #0000FF">throws</span></span> SpaceOccupiedException
<span style="color: #000000">00108:</span>   <span style="color: #FF0000">{</span>
<span style="color: #000000">00109:</span>     _name <span style="color: #990000">=</span> name<span style="color: #990000">;</span>
<span style="color: #000000">00110:</span>     <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(!</span>_w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">set</span></span><span style="color: #990000">(</span>x<span style="color: #990000">,</span>y<span style="color: #990000">,</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">))</span>
<span style="color: #000000">00111:</span>       <span style="font-weight: bold"><span style="color: #0000FF">throw</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">SpaceOccupiedException</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00112:</span>     _x <span style="color: #990000">=</span> x<span style="color: #990000">;</span>
<span style="color: #000000">00113:</span>     _y <span style="color: #990000">=</span> y<span style="color: #990000">;</span>
<span style="color: #000000">00114:</span>     _w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">+</span>_w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">currentTime</span></span><span style="color: #990000">(),</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">);</span>
<span style="color: #000000">00115:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00116:</span>   
<span style="color: #000000">00117:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #008080">String</span> <span style="font-weight: bold"><span style="color: #000000">toString</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> _name <span style="color: #990000">+</span> <span style="color: #FF0000">"@("</span> <span style="color: #990000">+</span> _x <span style="color: #990000">+</span> <span style="color: #FF0000">","</span> <span style="color: #990000">+</span> _y <span style="color: #990000">+</span> <span style="color: #FF0000">")"</span><span style="color: #990000">;</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00118:</span> 
<span style="color: #000000">00119:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">type</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> Visible<span style="color: #990000">.</span>TIGER<span style="color: #990000">;</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00120:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">check</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00121:</span>     <span style="font-weight: bold"><span style="color: #000000">checkAjacent</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00122:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00123:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00124:</span>     <span style="font-style: italic"><span style="color: #9A1900">//System.out.print(this + " moves to ");</span></span>
<span style="color: #000000">00125:</span>     <span style="font-weight: bold"><span style="color: #000000">moveRandom</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00126:</span>     <span style="font-style: italic"><span style="color: #9A1900">//System.out.println(this);</span></span>
<span style="color: #000000">00127:</span>     _w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span><span style="color: #993399">10</span><span style="color: #990000">+</span>_w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">currentTime</span></span><span style="color: #990000">(),</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">);</span>
<span style="color: #000000">00128:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00129:</span> 
<span style="color: #000000">00130:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">checkAjacent</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00131:</span>     <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> i<span style="color: #990000">=-</span><span style="color: #993399">1</span><span style="color: #990000">;</span> i<span style="color: #990000">&lt;=</span><span style="color: #993399">1</span><span style="color: #990000">;</span> i<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00132:</span>       <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> j<span style="color: #990000">=-</span><span style="color: #993399">1</span><span style="color: #990000">;</span> j<span style="color: #990000">&lt;=</span><span style="color: #993399">1</span><span style="color: #990000">;</span> j<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00133:</span>         <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>i<span style="color: #990000">==</span><span style="color: #993399">0</span> <span style="color: #990000">&amp;&amp;</span> j<span style="color: #990000">==</span><span style="color: #993399">0</span><span style="color: #990000">)</span>
<span style="color: #000000">00134:</span>           <span style="font-weight: bold"><span style="color: #0000FF">continue</span></span><span style="color: #990000">;</span>
<span style="color: #000000">00135:</span>         <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>_w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">(</span>_x<span style="color: #990000">+</span>i<span style="color: #990000">,</span>_y<span style="color: #990000">+</span>j<span style="color: #990000">).</span><span style="font-weight: bold"><span style="color: #000000">type</span></span><span style="color: #990000">()</span> <span style="color: #990000">==</span> Visible<span style="color: #990000">.</span>TIGER<span style="color: #990000">)</span>
<span style="color: #000000">00136:</span>           System<span style="color: #990000">.</span>out<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">println</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span> <span style="color: #990000">+</span> <span style="color: #FF0000">" roars at "</span> <span style="color: #990000">+</span> _w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">(</span>_x<span style="color: #990000">+</span>i<span style="color: #990000">,</span>_y<span style="color: #990000">+</span>j<span style="color: #990000">)</span> <span style="color: #990000">+</span> <span style="color: #FF0000">" at "</span> <span style="color: #990000">+</span> _w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">currentTime</span></span><span style="color: #990000">());</span>
<span style="color: #000000">00137:</span>       <span style="color: #FF0000">}</span>
<span style="color: #000000">00138:</span>     <span style="color: #FF0000">}</span>
<span style="color: #000000">00139:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00140:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">moveRandom</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00141:</span>     _w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">set</span></span><span style="color: #990000">(</span>_x<span style="color: #990000">,</span>_y<span style="color: #990000">,</span><span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">);</span>
<span style="color: #000000">00142:</span>     <span style="color: #009900">int</span> x<span style="color: #990000">,</span> y<span style="color: #990000">;</span> 
<span style="color: #000000">00143:</span>     <span style="font-weight: bold"><span style="color: #0000FF">do</span></span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00144:</span>       x <span style="color: #990000">=</span> <span style="color: #990000">(</span>_w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">maxx</span></span><span style="color: #990000">()</span> <span style="color: #990000">+</span> _x <span style="color: #990000">-</span><span style="color: #993399">1</span> <span style="color: #990000">+</span> Util<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">random</span></span><span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">))</span> <span style="color: #990000">%</span> _w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">maxx</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00145:</span>       y <span style="color: #990000">=</span> <span style="color: #990000">(</span>_w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">maxy</span></span><span style="color: #990000">()</span> <span style="color: #990000">+</span> _y <span style="color: #990000">-</span><span style="color: #993399">1</span> <span style="color: #990000">+</span> Util<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">random</span></span><span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">))</span> <span style="color: #990000">%</span> _w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">maxy</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00146:</span>       <span style="font-style: italic"><span style="color: #9A1900">//System.out.println("Trying (" + x + "," + y + ")");</span></span>
<span style="color: #000000">00147:</span>     <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(!</span>_w<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">set</span></span><span style="color: #990000">(</span>x<span style="color: #990000">,</span>y<span style="color: #990000">,</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">));</span>
<span style="color: #000000">00148:</span>     _x <span style="color: #990000">=</span> x<span style="color: #990000">;</span> _y <span style="color: #990000">=</span> y<span style="color: #990000">;</span>
<span style="color: #000000">00149:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00150:</span> <span style="color: #FF0000">}</span>  
<span style="color: #000000">00151:</span> </tt></pre>

</td></tr></table>
</td></tr></table>
</blockquote>
      <p> </p><table width="100%" class="title"><tr><td><span style="font-weight: bold; font-size: larger"><a name="slide008">Simulation: TimeServer Implementation</a></span><span style="font-weight: normal"><a href="class-07-008.html"> [8/13] </a></span></td></tr></table><p> </p>
        <p xmlns=""> </p><blockquote xmlns="">
<table width="97%">
<tr><td rowspan="1" colspan="1"><table width="100%" class="title"><tr><td rowspan="1" colspan="1"><b><a xmlns="http://www.w3.org/1999/xhtml" href="../code/html/agent/Agent_java.html">file:Agent.java</a> [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/src/agent/Agent.java">source</a>] [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/doc-publicagent/Agent.html">doc-public</a>] [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/doc-privateagent/Agent.html">doc-private</a>]</b></td></tr></table></td></tr>
<tr><td rowspan="1" colspan="1"><table width="100%" class="code"><tr><td rowspan="1" colspan="1">

<pre xml:space="preserve"><tt><span style="color: #000000">00001:</span> <span style="font-weight: bold"><span style="color: #000080">package</span></span> agent<span style="color: #990000">;</span>
<span style="color: #000000">00002:</span> 
<span style="color: #000000">00003:</span> <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">interface</span></span> <span style="color: #008080">Agent</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00004:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00005:</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00006:</span> </tt></pre>

</td></tr></table>
</td></tr></table>
</blockquote>
        <p xmlns=""> </p><blockquote xmlns="">
<table width="97%">
<tr><td rowspan="1" colspan="1"><table width="100%" class="title"><tr><td rowspan="1" colspan="1"><b><a xmlns="http://www.w3.org/1999/xhtml" href="../code/html/agent/TimeServer_java.html">file:TimeServer.java</a> [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/src/agent/TimeServer.java">source</a>] [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/doc-publicagent/TimeServer.html">doc-public</a>] [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/doc-privateagent/TimeServer.html">doc-private</a>]</b></td></tr></table></td></tr>
<tr><td rowspan="1" colspan="1"><table width="100%" class="code"><tr><td rowspan="1" colspan="1">

<pre xml:space="preserve"><tt><span style="color: #000000">00001:</span> <span style="font-weight: bold"><span style="color: #000080">package</span></span> agent<span style="color: #990000">;</span>
<span style="color: #000000">00002:</span> 
<span style="color: #000000">00003:</span> <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">interface</span></span> <span style="color: #008080">TimeServer</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00004:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">double</span> <span style="font-weight: bold"><span style="color: #000000">currentTime</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00005:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span><span style="color: #009900">double</span> waketime<span style="color: #990000">,</span> <span style="color: #008080">Agent</span> thing<span style="color: #990000">);</span>
<span style="color: #000000">00006:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">(</span><span style="color: #009900">double</span> duration<span style="color: #990000">);</span>
<span style="color: #000000">00007:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">addObserver</span></span><span style="color: #990000">(</span>java<span style="color: #990000">.</span>util<span style="color: #990000">.</span><span style="color: #008080">Observer</span> o<span style="color: #990000">);</span>
<span style="color: #000000">00008:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">deleteObserver</span></span><span style="color: #990000">(</span>java<span style="color: #990000">.</span>util<span style="color: #990000">.</span><span style="color: #008080">Observer</span> o<span style="color: #990000">);</span>
<span style="color: #000000">00009:</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00010:</span> </tt></pre>

</td></tr></table>
</td></tr></table>
</blockquote>
<pre xmlns="" xml:space="preserve">
If you want to use this for the project:

The idea is that whenever an agent adds itself to the timeserver, it
specifies its waketime.  The waketime must be greater than
currenttime, or the enqueue method should throw an exception.  The
timeserver orders agents by their waketime, so the one to wake first is
always at the front.  So in order to run the next agent, the first
agent is dequeued, and then the currenttime is set to its waketime,
then the agent is run.

For a car:
Start the car with waketime=currenttime.
When the car is run(), it should re-enqueue itself with
waketime=currenttime+timestep.

For a light:
Start the lightController with waketime=currenttime.
When the lightController is run(), it should re-enqueue itself with
waketime=currenttime+this._state.getDuration(), where the state
duration is whatever is appropriate for this state.

For a source:
Start the source with waketime=currenttime.
When the source is run(), it should re-enqueue itself with
waketime=currenttime+this._carCreationInterval, where the interval
indicates the time between car creations for this source.        
</pre>
        <p xmlns="">
          I implemented the <tt>TimeServer</tt> using a linked list
          with a <i>dummy node</i>.
        </p>
        <p xmlns=""> </p><blockquote xmlns="">
<table width="97%">
<tr><td rowspan="1" colspan="1"><table width="100%" class="title"><tr><td rowspan="1" colspan="1"><b><a xmlns="http://www.w3.org/1999/xhtml" href="../code/html/agent/TimeServerLinked_java.html">file:TimeServerLinked.java</a> [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/src/agent/TimeServerLinked.java">source</a>] [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/doc-publicagent/TimeServerLinked.html">doc-public</a>] [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/doc-privateagent/TimeServerLinked.html">doc-private</a>]</b></td></tr></table></td></tr>
<tr><td rowspan="1" colspan="1"><table width="100%" class="code"><tr><td rowspan="1" colspan="1">

<pre xml:space="preserve"><tt><span style="color: #000000">00001:</span> <span style="font-weight: bold"><span style="color: #000080">package</span></span> agent<span style="color: #990000">;</span>
<span style="color: #000000">00002:</span> 
<span style="color: #000000">00003:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> java<span style="color: #990000">.</span>util<span style="color: #990000">.</span>Observable<span style="color: #990000">;</span>
<span style="color: #000000">00004:</span> 
<span style="color: #000000">00005:</span> <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">final</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">TimeServerLinked</span> <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> Observable <span style="color: #008080">implements</span> TimeServer <span style="color: #FF0000">{</span>
<span style="color: #000000">00006:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">final</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Node</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00007:</span>     <span style="font-weight: bold"><span style="color: #0000FF">final</span></span> <span style="color: #009900">double</span> waketime<span style="color: #990000">;</span>
<span style="color: #000000">00008:</span>     <span style="font-weight: bold"><span style="color: #0000FF">final</span></span> <span style="color: #008080">Agent</span> agent<span style="color: #990000">;</span>
<span style="color: #000000">00009:</span>     <span style="color: #008080">Node</span> next<span style="color: #990000">;</span>
<span style="color: #000000">00010:</span>   
<span style="color: #000000">00011:</span>     <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #000000">Node</span></span><span style="color: #990000">(</span><span style="color: #009900">double</span> waketime<span style="color: #990000">,</span> <span style="color: #008080">Agent</span> agent<span style="color: #990000">,</span> <span style="color: #008080">Node</span> next<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00012:</span>       <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>waketime <span style="color: #990000">=</span> waketime<span style="color: #990000">;</span>
<span style="color: #000000">00013:</span>       <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>agent <span style="color: #990000">=</span> agent<span style="color: #990000">;</span>
<span style="color: #000000">00014:</span>       <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>next <span style="color: #990000">=</span> next<span style="color: #990000">;</span>
<span style="color: #000000">00015:</span>     <span style="color: #FF0000">}</span>
<span style="color: #000000">00016:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00017:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">double</span> _currentTime<span style="color: #990000">;</span>
<span style="color: #000000">00018:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">int</span> _size<span style="color: #990000">;</span>
<span style="color: #000000">00019:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> Node _head<span style="color: #990000">;</span>
<span style="color: #000000">00020:</span> 
<span style="color: #000000">00021:</span>   <span style="font-style: italic"><span style="color: #9A1900">/*</span></span>
<span style="color: #000000">00022:</span> <span style="font-style: italic"><span style="color: #9A1900">  * Invariant: _head != null</span></span>
<span style="color: #000000">00023:</span> <span style="font-style: italic"><span style="color: #9A1900">  * Invariant: _head.agent == null</span></span>
<span style="color: #000000">00024:</span> <span style="font-style: italic"><span style="color: #9A1900">  * Invariant: (_size == 0) iff (_head.next == null)</span></span>
<span style="color: #000000">00025:</span> <span style="font-style: italic"><span style="color: #9A1900">  */</span></span>
<span style="color: #000000">00026:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #000000">TimeServerLinked</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00027:</span>     _size <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #000000">00028:</span>     _head <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Node</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">);</span>
<span style="color: #000000">00029:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00030:</span> 
<span style="color: #000000">00031:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #008080">String</span> <span style="font-weight: bold"><span style="color: #000000">toString</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00032:</span>     <span style="color: #008080">StringBuilder</span> sb <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">StringBuilder</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"["</span><span style="color: #990000">);</span>
<span style="color: #000000">00033:</span>     <span style="color: #008080">Node</span> node <span style="color: #990000">=</span> _head<span style="color: #990000">.</span>next<span style="color: #990000">;</span>
<span style="color: #000000">00034:</span>     <span style="color: #008080">String</span> sep <span style="color: #990000">=</span> <span style="color: #FF0000">""</span><span style="color: #990000">;</span>
<span style="color: #000000">00035:</span>     <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span>node <span style="color: #990000">!=</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00036:</span>       sb<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">append</span></span><span style="color: #990000">(</span>sep<span style="color: #990000">).</span><span style="font-weight: bold"><span style="color: #000000">append</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"("</span><span style="color: #990000">).</span><span style="font-weight: bold"><span style="color: #000000">append</span></span><span style="color: #990000">(</span>node<span style="color: #990000">.</span>waketime<span style="color: #990000">).</span><span style="font-weight: bold"><span style="color: #000000">append</span></span><span style="color: #990000">(</span><span style="color: #FF0000">","</span><span style="color: #990000">)</span>
<span style="color: #000000">00037:</span>         <span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">append</span></span><span style="color: #990000">(</span>node<span style="color: #990000">.</span>agent<span style="color: #990000">).</span><span style="font-weight: bold"><span style="color: #000000">append</span></span><span style="color: #990000">(</span><span style="color: #FF0000">")"</span><span style="color: #990000">);</span>
<span style="color: #000000">00038:</span>       node <span style="color: #990000">=</span> node<span style="color: #990000">.</span>next<span style="color: #990000">;</span>
<span style="color: #000000">00039:</span>       sep <span style="color: #990000">=</span> <span style="color: #FF0000">";"</span><span style="color: #990000">;</span>
<span style="color: #000000">00040:</span>     <span style="color: #FF0000">}</span>
<span style="color: #000000">00041:</span>     sb<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">append</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"]"</span><span style="color: #990000">);</span>
<span style="color: #000000">00042:</span>     <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #990000">(</span>sb<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">toString</span></span><span style="color: #990000">());</span>
<span style="color: #000000">00043:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00044:</span> 
<span style="color: #000000">00045:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">double</span> <span style="font-weight: bold"><span style="color: #000000">currentTime</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00046:</span>     <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> _currentTime<span style="color: #990000">;</span>
<span style="color: #000000">00047:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00048:</span> 
<span style="color: #000000">00049:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span><span style="color: #009900">double</span> waketime<span style="color: #990000">,</span> <span style="color: #008080">Agent</span> agent<span style="color: #990000">)</span>
<span style="color: #000000">00050:</span>     <span style="font-weight: bold"><span style="color: #0000FF">throws</span></span> IllegalArgumentException
<span style="color: #000000">00051:</span>   <span style="color: #FF0000">{</span>
<span style="color: #000000">00052:</span>     <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>waketime <span style="color: #990000">&lt;</span> _currentTime<span style="color: #990000">)</span>
<span style="color: #000000">00053:</span>       <span style="font-weight: bold"><span style="color: #0000FF">throw</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">IllegalArgumentException</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00054:</span>     <span style="color: #008080">Node</span> prevElement <span style="color: #990000">=</span> _head<span style="color: #990000">;</span>
<span style="color: #000000">00055:</span>     <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">((</span>prevElement<span style="color: #990000">.</span>next <span style="color: #990000">!=</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">)</span> <span style="color: #990000">&amp;&amp;</span>
<span style="color: #000000">00056:</span>         <span style="color: #990000">(</span>prevElement<span style="color: #990000">.</span>next<span style="color: #990000">.</span>waketime <span style="color: #990000">&lt;=</span> waketime<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00057:</span>       prevElement <span style="color: #990000">=</span> prevElement<span style="color: #990000">.</span>next<span style="color: #990000">;</span>
<span style="color: #000000">00058:</span>     <span style="color: #FF0000">}</span>
<span style="color: #000000">00059:</span>     <span style="color: #008080">Node</span> newElement <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Node</span></span><span style="color: #990000">(</span>waketime<span style="color: #990000">,</span> agent<span style="color: #990000">,</span> prevElement<span style="color: #990000">.</span>next<span style="color: #990000">);</span>
<span style="color: #000000">00060:</span>     prevElement<span style="color: #990000">.</span>next <span style="color: #990000">=</span> newElement<span style="color: #990000">;</span>
<span style="color: #000000">00061:</span>     _size<span style="color: #990000">++;</span>
<span style="color: #000000">00062:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00063:</span> 
<span style="color: #000000">00064:</span>   <span style="color: #008080">Agent</span> <span style="font-weight: bold"><span style="color: #000000">dequeue</span></span><span style="color: #990000">()</span>
<span style="color: #000000">00065:</span>   <span style="color: #FF0000">{</span>
<span style="color: #000000">00066:</span>     <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>_size <span style="color: #990000">&lt;</span> <span style="color: #993399">1</span><span style="color: #990000">)</span>
<span style="color: #000000">00067:</span>       <span style="font-weight: bold"><span style="color: #0000FF">throw</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> java<span style="color: #990000">.</span>util<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">NoSuchElementException</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00068:</span>     <span style="color: #008080">Agent</span> rval <span style="color: #990000">=</span> _head<span style="color: #990000">.</span>next<span style="color: #990000">.</span>agent<span style="color: #990000">;</span>
<span style="color: #000000">00069:</span>     _head<span style="color: #990000">.</span>next <span style="color: #990000">=</span> _head<span style="color: #990000">.</span>next<span style="color: #990000">.</span>next<span style="color: #990000">;</span>
<span style="color: #000000">00070:</span>     _size<span style="color: #990000">--;</span>
<span style="color: #000000">00071:</span>     <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> rval<span style="color: #990000">;</span>
<span style="color: #000000">00072:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00073:</span> 
<span style="color: #000000">00074:</span>   <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00075:</span>     <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> _size<span style="color: #990000">;</span>
<span style="color: #000000">00076:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00077:</span> 
<span style="color: #000000">00078:</span>   <span style="color: #009900">boolean</span> <span style="font-weight: bold"><span style="color: #000000">empty</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00079:</span>     <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">()</span> <span style="color: #990000">==</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #000000">00080:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00081:</span> 
<span style="color: #000000">00082:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">(</span><span style="color: #009900">double</span> duration<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00083:</span>     <span style="color: #009900">double</span> endtime <span style="color: #990000">=</span> _currentTime <span style="color: #990000">+</span> duration<span style="color: #990000">;</span>
<span style="color: #000000">00084:</span>     <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">((!</span><span style="font-weight: bold"><span style="color: #000000">empty</span></span><span style="color: #990000">())</span> <span style="color: #990000">&amp;&amp;</span> <span style="color: #990000">(</span>_head<span style="color: #990000">.</span>next<span style="color: #990000">.</span>waketime <span style="color: #990000">&lt;=</span> endtime<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00085:</span>       <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">((</span>_currentTime <span style="color: #990000">-</span> _head<span style="color: #990000">.</span>next<span style="color: #990000">.</span>waketime<span style="color: #990000">)</span> <span style="color: #990000">&gt;</span> <span style="color: #993399">1e-09</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00086:</span>         <span style="font-weight: bold"><span style="color: #0000FF">super</span></span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setChanged</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00087:</span>         <span style="font-weight: bold"><span style="color: #0000FF">super</span></span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">notifyObservers</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00088:</span>       <span style="color: #FF0000">}</span>
<span style="color: #000000">00089:</span>       _currentTime <span style="color: #990000">=</span> _head<span style="color: #990000">.</span>next<span style="color: #990000">.</span>waketime<span style="color: #990000">;</span>
<span style="color: #000000">00090:</span>       <span style="font-weight: bold"><span style="color: #000000">dequeue</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00091:</span>     <span style="color: #FF0000">}</span>
<span style="color: #000000">00092:</span>     _currentTime <span style="color: #990000">=</span> endtime<span style="color: #990000">;</span>
<span style="color: #000000">00093:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00094:</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00095:</span> </tt></pre>

</td></tr></table>
</td></tr></table>
</blockquote>
        <p xmlns="">
          Note below how one tests <tt>TimeServer</tt> without any
          "real" agents.  Instead we use <i>Mock Objects</i>.  We also
          saw this in the tests for <tt>CommandHistoryObj</tt>.
          Tools such as 
          <a xmlns="http://www.w3.org/1999/xhtml" href="http://www.easymock.org/">easymock</a>
          make this easy.
        </p>
        <p xmlns=""> </p><blockquote xmlns="">
<table width="97%">
<tr><td rowspan="1" colspan="1"><table width="100%" class="title"><tr><td rowspan="1" colspan="1"><b><a xmlns="http://www.w3.org/1999/xhtml" href="../code/html/agent/TimeServerTEST_java.html">file:TimeServerTEST.java</a> [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/src/agent/TimeServerTEST.java">source</a>] [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/doc-publicagent/TimeServerTEST.html">doc-public</a>] [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/doc-privateagent/TimeServerTEST.html">doc-private</a>]</b></td></tr></table></td></tr>
<tr><td rowspan="1" colspan="1"><table width="100%" class="code"><tr><td rowspan="1" colspan="1">

<pre xml:space="preserve"><tt><span style="color: #000000">00001:</span> <span style="font-weight: bold"><span style="color: #000080">package</span></span> agent<span style="color: #990000">;</span>
<span style="color: #000000">00002:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> junit<span style="color: #990000">.</span>framework<span style="color: #990000">.</span>Assert<span style="color: #990000">;</span>
<span style="color: #000000">00003:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> junit<span style="color: #990000">.</span>framework<span style="color: #990000">.</span>TestCase<span style="color: #990000">;</span>
<span style="color: #000000">00004:</span> 
<span style="color: #000000">00005:</span> <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">TimeServerTEST</span> <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> TestCase <span style="color: #FF0000">{</span>
<span style="color: #000000">00006:</span>   <span style="color: #008080">TimeServerQueue</span> q <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">TimeServerQueue</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00007:</span>   <span style="font-style: italic"><span style="color: #9A1900">// TimeServerLinked q = new TimeServerLinked();</span></span>
<span style="color: #000000">00008:</span> 
<span style="color: #000000">00009:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #000000">TimeServerTEST</span></span><span style="color: #990000">(</span><span style="color: #008080">String</span> name<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00010:</span>     <span style="font-weight: bold"><span style="color: #0000FF">super</span></span><span style="color: #990000">(</span>name<span style="color: #990000">);</span>
<span style="color: #000000">00011:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00012:</span> 
<span style="color: #000000">00013:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">testThatEmptySizeIsZero</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00014:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertEquals</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">,</span> q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">());</span>
<span style="color: #000000">00015:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00016:</span> 
<span style="color: #000000">00017:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">testThatDequeueOnEmptyThrowsIndexOutOfBoundsException</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00018:</span>     <span style="color: #009900">boolean</span> exceptionOccurred <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
<span style="color: #000000">00019:</span> 
<span style="color: #000000">00020:</span>     <span style="font-weight: bold"><span style="color: #0000FF">try</span></span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00021:</span>       <span style="color: #008080">Agent</span> o <span style="color: #990000">=</span> q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">dequeue</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00022:</span>     <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">catch</span></span> <span style="color: #990000">(</span>java<span style="color: #990000">.</span>util<span style="color: #990000">.</span><span style="color: #008080">NoSuchElementException</span> e<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00023:</span>       exceptionOccurred <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">;</span>
<span style="color: #000000">00024:</span>     <span style="color: #FF0000">}</span>
<span style="color: #000000">00025:</span> 
<span style="color: #000000">00026:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertTrue</span></span><span style="color: #990000">(</span>exceptionOccurred<span style="color: #990000">);</span>
<span style="color: #000000">00027:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00028:</span> 
<span style="color: #000000">00029:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">testThatEnqueueFollowedByDequeueReturnsSameReference</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00030:</span>     <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">TestThatEnqueueFollowedByDequeueReturnsSameReference</span>
<span style="color: #000000">00031:</span>       <span style="font-weight: bold"><span style="color: #0000FF">implements</span></span> Agent
<span style="color: #000000">00032:</span>     <span style="color: #FF0000">{</span>
<span style="color: #000000">00033:</span>       <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{}</span>
<span style="color: #000000">00034:</span>     <span style="color: #FF0000">}</span>
<span style="color: #000000">00035:</span> 
<span style="color: #000000">00036:</span>     <span style="color: #008080">Agent</span> x1 <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">TestThatEnqueueFollowedByDequeueReturnsSameReference</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00037:</span>     q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">,</span> x1<span style="color: #990000">);</span>
<span style="color: #000000">00038:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertSame</span></span><span style="color: #990000">(</span>x1<span style="color: #990000">,</span> q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">dequeue</span></span><span style="color: #990000">());</span>
<span style="color: #000000">00039:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertEquals</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">,</span> q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">size</span></span><span style="color: #990000">());</span>
<span style="color: #000000">00040:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00041:</span> 
<span style="color: #000000">00042:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">testThatElementsAreInsertedInOrder</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00043:</span>     <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">TestThatElementsAreInsertedInOrder</span> <span style="font-weight: bold"><span style="color: #0000FF">implements</span></span> Agent <span style="color: #FF0000">{</span>
<span style="color: #000000">00044:</span>       <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{}</span>
<span style="color: #000000">00045:</span>     <span style="color: #FF0000">}</span>
<span style="color: #000000">00046:</span> 
<span style="color: #000000">00047:</span>     <span style="color: #008080">Agent</span> x1 <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">TestThatElementsAreInsertedInOrder</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00048:</span>     <span style="color: #008080">Agent</span> x2 <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">TestThatElementsAreInsertedInOrder</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00049:</span>     q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">,</span> x2<span style="color: #990000">);</span>
<span style="color: #000000">00050:</span>     q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span> x1<span style="color: #990000">);</span>
<span style="color: #000000">00051:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertSame</span></span><span style="color: #990000">(</span>x2<span style="color: #990000">,</span> q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">dequeue</span></span><span style="color: #990000">());</span>
<span style="color: #000000">00052:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertSame</span></span><span style="color: #990000">(</span>x1<span style="color: #990000">,</span> q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">dequeue</span></span><span style="color: #990000">());</span>
<span style="color: #000000">00053:</span>     q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span> x1<span style="color: #990000">);</span>
<span style="color: #000000">00054:</span>     q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">,</span> x2<span style="color: #990000">);</span>
<span style="color: #000000">00055:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertSame</span></span><span style="color: #990000">(</span>x2<span style="color: #990000">,</span> q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">dequeue</span></span><span style="color: #990000">());</span>
<span style="color: #000000">00056:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertSame</span></span><span style="color: #990000">(</span>x1<span style="color: #990000">,</span> q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">dequeue</span></span><span style="color: #990000">());</span>
<span style="color: #000000">00057:</span>     q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">,</span> x1<span style="color: #990000">);</span>
<span style="color: #000000">00058:</span>     q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">,</span> x2<span style="color: #990000">);</span>
<span style="color: #000000">00059:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertSame</span></span><span style="color: #990000">(</span>x1<span style="color: #990000">,</span> q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">dequeue</span></span><span style="color: #990000">());</span>
<span style="color: #000000">00060:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertSame</span></span><span style="color: #990000">(</span>x2<span style="color: #990000">,</span> q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">dequeue</span></span><span style="color: #990000">());</span>
<span style="color: #000000">00061:</span>     q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">,</span> x2<span style="color: #990000">);</span>
<span style="color: #000000">00062:</span>     q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">,</span> x1<span style="color: #990000">);</span>
<span style="color: #000000">00063:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertSame</span></span><span style="color: #990000">(</span>x2<span style="color: #990000">,</span> q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">dequeue</span></span><span style="color: #990000">());</span>
<span style="color: #000000">00064:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertSame</span></span><span style="color: #990000">(</span>x1<span style="color: #990000">,</span> q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">dequeue</span></span><span style="color: #990000">());</span>
<span style="color: #000000">00065:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00066:</span> 
<span style="color: #000000">00067:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">testToString</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00068:</span>     <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">TestToString</span> <span style="font-weight: bold"><span style="color: #0000FF">implements</span></span> Agent <span style="color: #FF0000">{</span>
<span style="color: #000000">00069:</span>       <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{}</span>
<span style="color: #000000">00070:</span>       <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #008080">String</span> <span style="font-weight: bold"><span style="color: #000000">toString</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"x"</span><span style="color: #990000">;</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00071:</span>     <span style="color: #FF0000">}</span>
<span style="color: #000000">00072:</span> 
<span style="color: #000000">00073:</span>     q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">TestToString</span></span><span style="color: #990000">());</span>
<span style="color: #000000">00074:</span>     q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">TestToString</span></span><span style="color: #990000">());</span>
<span style="color: #000000">00075:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertEquals</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"[(0.0,x);(1.0,x)]"</span><span style="color: #990000">,</span> q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">toString</span></span><span style="color: #990000">());</span>
<span style="color: #000000">00076:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00077:</span> 
<span style="color: #000000">00078:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">testCurrentTime</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00079:</span>     <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">TestCurrentTime</span> <span style="font-weight: bold"><span style="color: #0000FF">implements</span></span> Agent <span style="color: #FF0000">{</span>
<span style="color: #000000">00080:</span>       <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{}</span>
<span style="color: #000000">00081:</span>     <span style="color: #FF0000">}</span>
<span style="color: #000000">00082:</span> 
<span style="color: #000000">00083:</span>     <span style="color: #009900">double</span> expected <span style="color: #990000">=</span> <span style="color: #993399">1230</span><span style="color: #990000">;</span>
<span style="color: #000000">00084:</span>     q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span>expected<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">TestCurrentTime</span></span><span style="color: #990000">());</span>
<span style="color: #000000">00085:</span> 
<span style="color: #000000">00086:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertEquals</span></span><span style="color: #990000">(</span><span style="color: #993399">0.0</span><span style="color: #990000">,</span> q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">currentTime</span></span><span style="color: #990000">());</span>
<span style="color: #000000">00087:</span>     q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">(</span>expected<span style="color: #990000">);</span>
<span style="color: #000000">00088:</span>     
<span style="color: #000000">00089:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertEquals</span></span><span style="color: #990000">(</span>expected<span style="color: #990000">,</span> q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">currentTime</span></span><span style="color: #990000">());</span>
<span style="color: #000000">00090:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00091:</span> 
<span style="color: #000000">00092:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">double</span> _scratch<span style="color: #990000">;</span>
<span style="color: #000000">00093:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">testDoActionsAtOrBefore</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00094:</span>     <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">TestDoActionsAtOrBefore</span> <span style="font-weight: bold"><span style="color: #0000FF">implements</span></span> Agent <span style="color: #FF0000">{</span>
<span style="color: #000000">00095:</span>       <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">double</span> _myScratch<span style="color: #990000">;</span>
<span style="color: #000000">00096:</span>       <span style="font-weight: bold"><span style="color: #000000">TestDoActionsAtOrBefore</span></span><span style="color: #990000">(</span><span style="color: #009900">double</span> myScratch<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00097:</span>         _myScratch <span style="color: #990000">=</span> myScratch<span style="color: #990000">;</span>
<span style="color: #000000">00098:</span>       <span style="color: #FF0000">}</span>
<span style="color: #000000">00099:</span>       <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00100:</span>         _scratch <span style="color: #990000">=</span> _myScratch<span style="color: #990000">;</span>
<span style="color: #000000">00101:</span>       <span style="color: #FF0000">}</span>
<span style="color: #000000">00102:</span>     <span style="color: #FF0000">}</span>
<span style="color: #000000">00103:</span> 
<span style="color: #000000">00104:</span>     <span style="color: #009900">double</span> time1 <span style="color: #990000">=</span> <span style="color: #993399">12</span><span style="color: #990000">;</span>
<span style="color: #000000">00105:</span>     <span style="color: #009900">double</span> time2 <span style="color: #990000">=</span> <span style="color: #993399">23</span><span style="color: #990000">;</span>
<span style="color: #000000">00106:</span>     <span style="color: #009900">double</span> value1 <span style="color: #990000">=</span> <span style="color: #993399">42</span><span style="color: #990000">;</span>
<span style="color: #000000">00107:</span>     <span style="color: #009900">double</span> value2 <span style="color: #990000">=</span> <span style="color: #993399">27</span><span style="color: #990000">;</span>
<span style="color: #000000">00108:</span> 
<span style="color: #000000">00109:</span>     q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span>time1<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">TestDoActionsAtOrBefore</span></span><span style="color: #990000">(</span>value1<span style="color: #990000">));</span>
<span style="color: #000000">00110:</span> 
<span style="color: #000000">00111:</span>     _scratch <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #000000">00112:</span>     q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">(</span>time1 <span style="color: #990000">-</span> <span style="color: #993399">1</span><span style="color: #990000">);</span>
<span style="color: #000000">00113:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertEquals</span></span><span style="color: #990000">(</span><span style="color: #993399">0.0</span><span style="color: #990000">,</span> _scratch<span style="color: #990000">);</span>
<span style="color: #000000">00114:</span> 
<span style="color: #000000">00115:</span>     _scratch <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #000000">00116:</span>     q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">);</span>
<span style="color: #000000">00117:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertEquals</span></span><span style="color: #990000">(</span>value1<span style="color: #990000">,</span> _scratch<span style="color: #990000">);</span>
<span style="color: #000000">00118:</span> 
<span style="color: #000000">00119:</span>     q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">enqueue</span></span><span style="color: #990000">(</span>time2<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">TestDoActionsAtOrBefore</span></span><span style="color: #990000">(</span>value2<span style="color: #990000">));</span>
<span style="color: #000000">00120:</span> 
<span style="color: #000000">00121:</span>     _scratch <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #000000">00122:</span>     q<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">(</span>time2<span style="color: #990000">);</span>
<span style="color: #000000">00123:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertEquals</span></span><span style="color: #990000">(</span>value2<span style="color: #990000">,</span> _scratch<span style="color: #990000">);</span>
<span style="color: #000000">00124:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00125:</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00126:</span> </tt></pre>

</td></tr></table>
</td></tr></table>
</blockquote>
      <p> </p><table width="100%" class="title"><tr><td><span style="font-weight: bold; font-size: larger"><a name="slide009">Simulation: Random numbers</a></span><span style="font-weight: normal"><a href="class-07-009.html"> [9/13] </a></span></td></tr></table><p> </p>
        <p xmlns="">
          To get predictable numbers, use <code>Random(long
          seed)</code>.  If you use the seed every time, you get the
          same series of random numbers.
        </p>
        <a href="http://java.sun.com/javase/6/docs/api/java/util/Random.html">java.util.Random</a>
        <p xmlns=""> </p><blockquote xmlns="">
<table width="97%">
<tr><td rowspan="1" colspan="1"><table width="100%" class="title"><tr><td rowspan="1" colspan="1"><b><a xmlns="http://www.w3.org/1999/xhtml" href="../code/html/random/Util_java.html">file:random/Util.java</a> [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/src/random/Util.java">source</a>] [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/doc-public/random/Util.html">doc-public</a>] [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/doc-private/random/Util.html">doc-private</a>]</b></td></tr></table></td></tr>
<tr><td rowspan="1" colspan="1"><table width="100%" class="code"><tr><td rowspan="1" colspan="1">

<pre xml:space="preserve"><tt><span style="color: #000000">00001:</span> <span style="font-weight: bold"><span style="color: #000080">package</span></span> random<span style="color: #990000">;</span>
<span style="color: #000000">00002:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> java<span style="color: #990000">.</span>util<span style="color: #990000">.</span>Random<span style="color: #990000">;</span>
<span style="color: #000000">00003:</span> 
<span style="color: #000000">00004:</span> <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Util</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00005:</span>   <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #000000">Util</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{}</span>
<span style="color: #000000">00006:</span>   <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> Random _RANDOM <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Random</span></span><span style="color: #990000">();</span>
<span style="color: #000000">00007:</span> 
<span style="color: #000000">00008:</span>   <span style="font-style: italic"><span style="color: #9A1900">/** doubles that differ by less than EPSILON should be considered equals */</span></span>
<span style="color: #000000">00009:</span>   <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">final</span></span> <span style="color: #009900">double</span> EPSILON <span style="color: #990000">=</span> <span style="color: #993399">1e-9</span><span style="color: #990000">;</span>
<span style="color: #000000">00010:</span>   <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">boolean</span> <span style="font-weight: bold"><span style="color: #000000">isEquals</span></span><span style="color: #990000">(</span><span style="color: #009900">double</span> x<span style="color: #990000">,</span> <span style="color: #009900">double</span> y<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00011:</span>     <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> Math<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">abs</span></span><span style="color: #990000">(</span>x<span style="color: #990000">-</span>y<span style="color: #990000">)</span> <span style="color: #990000">&lt;=</span> EPSILON<span style="color: #990000">;</span>
<span style="color: #000000">00012:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00013:</span>   <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">boolean</span> <span style="font-weight: bold"><span style="color: #000000">isLessOrEquals</span></span><span style="color: #990000">(</span><span style="color: #009900">double</span> x<span style="color: #990000">,</span> <span style="color: #009900">double</span> y<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00014:</span>     <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #990000">(</span>x<span style="color: #990000">-</span>y<span style="color: #990000">)</span> <span style="color: #990000">&lt;=</span> EPSILON<span style="color: #990000">;</span>
<span style="color: #000000">00015:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00016:</span>   <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">boolean</span> <span style="font-weight: bold"><span style="color: #000000">isLess</span></span><span style="color: #990000">(</span><span style="color: #009900">double</span> x<span style="color: #990000">,</span> <span style="color: #009900">double</span> y<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00017:</span>     <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #990000">(</span>x<span style="color: #990000">-</span>y<span style="color: #990000">)</span> <span style="color: #990000">&lt;</span> <span style="color: #990000">-</span>EPSILON<span style="color: #990000">;</span>
<span style="color: #000000">00018:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00019:</span> 
<span style="color: #000000">00020:</span>   <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">setRandomSeed</span></span><span style="color: #990000">(</span><span style="color: #009900">long</span> seed<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00021:</span>     _RANDOM<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setSeed</span></span><span style="color: #990000">(</span>seed<span style="color: #990000">);</span>
<span style="color: #000000">00022:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00023:</span>   <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">double</span> <span style="font-weight: bold"><span style="color: #000000">nextRandom</span></span><span style="color: #990000">(</span><span style="color: #009900">double</span> min<span style="color: #990000">,</span> <span style="color: #009900">double</span> max<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00024:</span>     <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>Util<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">isLess</span></span><span style="color: #990000">(</span>max<span style="color: #990000">,</span>min<span style="color: #990000">))</span>
<span style="color: #000000">00025:</span>       <span style="font-weight: bold"><span style="color: #0000FF">throw</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">IllegalArgumentException</span></span><span style="color: #990000">(</span>max <span style="color: #990000">+</span> <span style="color: #FF0000">" is smaller than "</span> <span style="color: #990000">+</span> min<span style="color: #990000">);</span>
<span style="color: #000000">00026:</span>     <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> min <span style="color: #990000">+</span> <span style="color: #990000">((</span>_RANDOM<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">nextDouble</span></span><span style="color: #990000">())</span> <span style="color: #990000">*</span> <span style="color: #990000">(</span>max <span style="color: #990000">-</span> min<span style="color: #990000">));</span>
<span style="color: #000000">00027:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00028:</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00029:</span> </tt></pre>

</td></tr></table>
</td></tr></table>
</blockquote>
        <p xmlns=""> </p><blockquote xmlns="">
<table width="97%">
<tr><td rowspan="1" colspan="1"><table width="100%" class="title"><tr><td rowspan="1" colspan="1"><b><a xmlns="http://www.w3.org/1999/xhtml" href="../code/html/random/UtilTEST_java.html">file:random/UtilTEST.java</a> [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/src/random/UtilTEST.java">source</a>] [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/doc-public/random/UtilTEST.html">doc-public</a>] [<a xmlns="http://www.w3.org/1999/xhtml" href="../code/doc-private/random/UtilTEST.html">doc-private</a>]</b></td></tr></table></td></tr>
<tr><td rowspan="1" colspan="1"><table width="100%" class="code"><tr><td rowspan="1" colspan="1">

<pre xml:space="preserve"><tt><span style="color: #000000">00001:</span> <span style="font-weight: bold"><span style="color: #000080">package</span></span> random<span style="color: #990000">;</span>
<span style="color: #000000">00002:</span> 
<span style="color: #000000">00003:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> junit<span style="color: #990000">.</span>framework<span style="color: #990000">.</span>Assert<span style="color: #990000">;</span>
<span style="color: #000000">00004:</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> junit<span style="color: #990000">.</span>framework<span style="color: #990000">.</span>TestCase<span style="color: #990000">;</span>
<span style="color: #000000">00005:</span> 
<span style="color: #000000">00006:</span> <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">UtilTEST</span> <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> TestCase <span style="color: #FF0000">{</span>
<span style="color: #000000">00007:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #000000">UtilTEST</span></span><span style="color: #990000">(</span><span style="color: #008080">String</span> name<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00008:</span>     <span style="font-weight: bold"><span style="color: #0000FF">super</span></span><span style="color: #990000">(</span>name<span style="color: #990000">);</span>
<span style="color: #000000">00009:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00010:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">testequals</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00011:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertTrue</span></span> <span style="color: #990000">(</span>Util<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">isEquals</span></span><span style="color: #990000">(</span><span style="color: #993399">0.3</span><span style="color: #990000">,</span> <span style="color: #993399">0.3</span><span style="color: #990000">+</span><span style="color: #993399">0.5</span><span style="color: #990000">*</span>Util<span style="color: #990000">.</span>EPSILON<span style="color: #990000">));</span>
<span style="color: #000000">00012:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertFalse</span></span><span style="color: #990000">(</span>Util<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">isEquals</span></span><span style="color: #990000">(</span><span style="color: #993399">0.3</span><span style="color: #990000">,</span> <span style="color: #993399">0.3</span><span style="color: #990000">+</span><span style="color: #993399">2.0</span><span style="color: #990000">*</span>Util<span style="color: #990000">.</span>EPSILON<span style="color: #990000">));</span>
<span style="color: #000000">00013:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertFalse</span></span><span style="color: #990000">(</span>Util<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">isLess</span></span><span style="color: #990000">(</span><span style="color: #993399">0.3</span><span style="color: #990000">,</span> <span style="color: #993399">0.3</span><span style="color: #990000">+</span><span style="color: #993399">0.5</span><span style="color: #990000">*</span>Util<span style="color: #990000">.</span>EPSILON<span style="color: #990000">));</span>
<span style="color: #000000">00014:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertTrue</span></span> <span style="color: #990000">(</span>Util<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">isLess</span></span><span style="color: #990000">(</span><span style="color: #993399">0.3</span><span style="color: #990000">,</span> <span style="color: #993399">0.3</span><span style="color: #990000">+</span><span style="color: #993399">2.0</span><span style="color: #990000">*</span>Util<span style="color: #990000">.</span>EPSILON<span style="color: #990000">));</span>
<span style="color: #000000">00015:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertTrue</span></span> <span style="color: #990000">(</span>Util<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">isLessOrEquals</span></span><span style="color: #990000">(</span><span style="color: #993399">0.3</span><span style="color: #990000">,</span> <span style="color: #993399">0.3</span><span style="color: #990000">+</span><span style="color: #993399">0.5</span><span style="color: #990000">*</span>Util<span style="color: #990000">.</span>EPSILON<span style="color: #990000">));</span>
<span style="color: #000000">00016:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertTrue</span></span> <span style="color: #990000">(</span>Util<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">isLessOrEquals</span></span><span style="color: #990000">(</span><span style="color: #993399">0.3</span><span style="color: #990000">,</span> <span style="color: #993399">0.3</span><span style="color: #990000">+</span><span style="color: #993399">2.0</span><span style="color: #990000">*</span>Util<span style="color: #990000">.</span>EPSILON<span style="color: #990000">));</span>
<span style="color: #000000">00017:</span> 
<span style="color: #000000">00018:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertTrue</span></span> <span style="color: #990000">(</span>Util<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">isEquals</span></span><span style="color: #990000">(</span><span style="color: #993399">0.3</span><span style="color: #990000">+</span><span style="color: #993399">0.5</span><span style="color: #990000">*</span>Util<span style="color: #990000">.</span>EPSILON<span style="color: #990000">,</span> <span style="color: #993399">0.3</span><span style="color: #990000">));</span>
<span style="color: #000000">00019:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertFalse</span></span><span style="color: #990000">(</span>Util<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">isEquals</span></span><span style="color: #990000">(</span><span style="color: #993399">0.3</span><span style="color: #990000">+</span><span style="color: #993399">2.0</span><span style="color: #990000">*</span>Util<span style="color: #990000">.</span>EPSILON<span style="color: #990000">,</span> <span style="color: #993399">0.3</span><span style="color: #990000">));</span>
<span style="color: #000000">00020:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertFalse</span></span><span style="color: #990000">(</span>Util<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">isLess</span></span><span style="color: #990000">(</span><span style="color: #993399">0.3</span><span style="color: #990000">+</span><span style="color: #993399">0.5</span><span style="color: #990000">*</span>Util<span style="color: #990000">.</span>EPSILON<span style="color: #990000">,</span> <span style="color: #993399">0.3</span><span style="color: #990000">));</span>
<span style="color: #000000">00021:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertFalse</span></span><span style="color: #990000">(</span>Util<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">isLess</span></span><span style="color: #990000">(</span><span style="color: #993399">0.3</span><span style="color: #990000">+</span><span style="color: #993399">2.0</span><span style="color: #990000">*</span>Util<span style="color: #990000">.</span>EPSILON<span style="color: #990000">,</span> <span style="color: #993399">0.3</span><span style="color: #990000">));</span>
<span style="color: #000000">00022:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertTrue</span></span> <span style="color: #990000">(</span>Util<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">isLessOrEquals</span></span><span style="color: #990000">(</span><span style="color: #993399">0.3</span><span style="color: #990000">+</span><span style="color: #993399">0.5</span><span style="color: #990000">*</span>Util<span style="color: #990000">.</span>EPSILON<span style="color: #990000">,</span> <span style="color: #993399">0.3</span><span style="color: #990000">));</span>
<span style="color: #000000">00023:</span>     Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertFalse</span></span><span style="color: #990000">(</span>Util<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">isLessOrEquals</span></span><span style="color: #990000">(</span><span style="color: #993399">0.3</span><span style="color: #990000">+</span><span style="color: #993399">2.0</span><span style="color: #990000">*</span>Util<span style="color: #990000">.</span>EPSILON<span style="color: #990000">,</span> <span style="color: #993399">0.3</span><span style="color: #990000">));</span>
<span style="color: #000000">00024:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00025:</span>   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">testrandom</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00026:</span>     <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> i<span style="color: #990000">=</span><span style="color: #993399">0</span><span style="color: #990000">;</span> i<span style="color: #990000">&lt;</span><span style="color: #993399">100</span><span style="color: #990000">;</span> i<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">00027:</span>       <span style="color: #009900">double</span> x<span style="color: #990000">=</span>Util<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">nextRandom</span></span><span style="color: #990000">(</span>i<span style="color: #990000">,</span>i<span style="color: #990000">*</span>i<span style="color: #990000">);</span>
<span style="color: #000000">00028:</span>       Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertTrue</span></span> <span style="color: #990000">(</span>Util<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">isLessOrEquals</span></span><span style="color: #990000">(</span>i<span style="color: #990000">,</span>x<span style="color: #990000">));</span>
<span style="color: #000000">00029:</span>       Assert<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertTrue</span></span> <span style="color: #990000">(</span>Util<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">isLessOrEquals</span></span><span style="color: #990000">(</span>x<span style="color: #990000">,</span>i<span style="color: #990000">*</span>i<span style="color: #990000">));</span>
<span style="color: #000000">00030:</span>     <span style="color: #FF0000">}</span>
<span style="color: #000000">00031:</span>   <span style="color: #FF0000">}</span>
<span style="color: #000000">00032:</span> <span style="color: #FF0000">}</span>
<span style="color: #000000">00033:</span> </tt></pre>

</td></tr></table>
</td></tr></table>
</blockquote>
      <p> </p><table width="100%" class="title"><tr><td><span style="font-weight: bold; font-size: larger"><a name="slide010">Project: Car Movement</a></span><span style="font-weight: normal"><a href="class-07-010.html"> [10/13] </a></span></td></tr></table><p> </p>
        <p xmlns="">
          How do cars move?
        </p>
      <p> </p><table width="100%" cellpadding="0" cellspacing="0" class="notes"><tr><td>
        <p xmlns="">
          Here is a sketch of one solution to the problem of car
          movement.
        </p>

<pre xmlns="" xml:space="preserve"><tt><span style="font-weight: bold"><span style="color: #0000FF">interface</span></span> <span style="color: #008080">CarAcceptor</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">boolean</span> <span style="font-weight: bold"><span style="color: #000000">accept</span></span><span style="color: #990000">(</span><span style="color: #008080">Car</span> c<span style="color: #990000">,</span> <span style="color: #009900">float</span> frontPosition<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Road</span> <span style="font-weight: bold"><span style="color: #0000FF">implements</span></span> CarAcceptor <span style="color: #FF0000">{</span>
  <span style="color: #008080">Set</span> cars<span style="color: #990000">;</span>
  <span style="color: #009900">float</span> endPosition<span style="color: #990000">;</span>
  <span style="color: #008080">CarAcceptor</span> nextRoad<span style="color: #990000">;</span>
  <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">boolean</span> <span style="font-weight: bold"><span style="color: #000000">accept</span></span><span style="color: #990000">(</span><span style="color: #008080">Car</span> c<span style="color: #990000">,</span> <span style="color: #009900">float</span> frontPosition<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    cars<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">remove</span></span><span style="color: #990000">(</span>c<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span><span style="color: #990000">(</span>frontPosition<span style="color: #990000">&gt;</span>endPosition<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
      <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> nextRoad<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">accept</span></span><span style="color: #990000">(</span>c<span style="color: #990000">,</span>frontPosition<span style="color: #990000">-</span>endPosition<span style="color: #990000">)</span>
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
      c<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setCurrentRoad</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">);</span>
      c<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setFrontPosition</span></span><span style="color: #990000">(</span>frontPosition<span style="color: #990000">);</span>
      cars<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add</span></span><span style="color: #990000">(</span>c<span style="color: #990000">);</span>
      <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
  <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">interface</span></span> <span style="color: #008080">Agent</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span> <span style="color: #990000">();</span>
<span style="color: #FF0000">}</span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Car</span> <span style="color: #008080">implents</span> Agent <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">int</span> sleepSeconds<span style="color: #990000">;</span>
  <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">float</span> frontPosition<span style="color: #990000">;</span>
  <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #008080">Road</span> currentRoad<span style="color: #990000">;</span>
  <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #008080">TimeServer</span> agents<span style="color: #990000">;</span>
  <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
    <span style="font-style: italic"><span style="color: #9A1900">// calculate newFrontPosition</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>currentRoad<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">accept</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> newFrontPosition<span style="color: #990000">))</span>
       agents<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> Agents<span style="color: #990000">.</span>currentTime<span style="color: #990000">+</span>sleepSeconds<span style="color: #990000">);</span>
  <span style="color: #FF0000">}</span>
  <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">setCurrentRoad</span></span><span style="color: #990000">(...)</span> <span style="color: #990000">...</span> <span style="font-style: italic"><span style="color: #9A1900">// for Road</span></span>
  <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">setFrontPosition</span></span><span style="color: #990000">(...)</span> <span style="color: #990000">...</span> <span style="font-style: italic"><span style="color: #9A1900">// for Road</span></span>
<span style="color: #FF0000">}</span>
</tt></pre>

        <p xmlns="">
          Here is a sketch of how to compute the distance to the
          closest obstacle.
          A simple example:
        </p>
        <p xmlns="">
          r1 feeds into r2.  Both are 100m long.
          c1 and c2 have frontPosition at 70m and 20m on the repspective roads. Both are 10m long.
          So distance from c1 to obstacle should be 40m.
        </p>
<pre xmlns="" xml:space="preserve">
c1 ---distanceToObstacle(70)---&gt; r1
                                 r1 ---distanceToObstacle(-30)--&gt; r2
                                                                  r2 ---backPosition()--&gt; c2
                                                                  r2 &lt; - - - - - - 10 - - c2
                                 r1 &lt; - - - - - - - - - - - 40 -  r2
c1 &lt; - - - - - - - - - - 40 - -  r1
</pre>
<p xmlns="">
The following code is not debugged, but that is what is intended to do:
</p>

<pre xmlns="" xml:space="preserve"><tt><span style="font-weight: bold"><span style="color: #0000FF">interface</span></span> <span style="color: #008080">CarAcceptor</span> <span style="color: #FF0000">{</span> <span style="color: #990000">...</span>
  <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">double</span> <span style="font-weight: bold"><span style="color: #000000">distanceToObstacle</span></span><span style="color: #990000">(</span><span style="color: #009900">double</span> fromPosition<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Sink</span> <span style="font-weight: bold"><span style="color: #0000FF">implements</span></span> CarAcceptor <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">double</span> <span style="font-weight: bold"><span style="color: #000000">distanceToObstacle</span></span><span style="color: #990000">(</span><span style="color: #009900">double</span> fromPosition<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> Double<span style="color: #990000">.</span>POSITIVE_INFINITY<span style="color: #990000">;</span>
  <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Road</span> <span style="font-weight: bold"><span style="color: #0000FF">implements</span></span> CarAcceptor <span style="color: #FF0000">{</span>
  <span style="color: #008080">Set</span> cars<span style="color: #990000">;</span>
  <span style="color: #008080">CarAcceptor</span> nextRoad<span style="color: #990000">;</span>
  <span style="color: #009900">double</span> endPosition<span style="color: #990000">;</span>
  <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">double</span> <span style="font-weight: bold"><span style="color: #000000">distanceToCarBack</span></span><span style="color: #990000">(</span><span style="color: #009900">double</span> fromPosition<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">double</span> carBackPosition <span style="color: #990000">=</span> Double<span style="color: #990000">.</span>POSITIVE_INFINITY<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #008080">Car</span> c <span style="color: #990000">:</span> cars<span style="color: #990000">)</span>
      <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>c<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">backPosition</span></span><span style="color: #990000">()</span> <span style="color: #990000">&gt;=</span> fromPosition <span style="color: #990000">&amp;&amp;</span>
          c<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">backPosition</span></span><span style="color: #990000">()</span> <span style="color: #990000">&lt;</span> carBackPosition<span style="color: #990000">)</span>
         carBackPosition <span style="color: #990000">=</span> c<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">backPosition</span></span><span style="color: #990000">();</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> carBackPosition<span style="color: #990000">;</span>
  <span style="color: #FF0000">}</span>
  <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">double</span> <span style="font-weight: bold"><span style="color: #000000">distanceToObstacle</span></span><span style="color: #990000">(</span><span style="color: #009900">double</span> fromPosition<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">double</span> obstaclePosition <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">distanceToCarBack</span></span><span style="color: #990000">(</span>fromPosition<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>obstaclePosition <span style="color: #990000">==</span> Double<span style="color: #990000">.</span>POSITIVE_INFINITY<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
      <span style="color: #009900">double</span> distanceToEnd <span style="color: #990000">=</span> fromPosition<span style="color: #990000">-</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>endPosition<span style="color: #990000">;</span>
      obstaclePosition 
        <span style="color: #990000">=</span> nextRoad<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">distanceToObstacle</span></span><span style="color: #990000">(</span>fromPosition<span style="color: #990000">-</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>endPosition<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> obstaclePosition<span style="color: #990000">-</span>fromPosition<span style="color: #990000">;</span>
  <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Car</span> <span style="font-weight: bold"><span style="color: #0000FF">implements</span></span> Agent <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">double</span> length<span style="color: #990000">;</span>
  <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">double</span> frontPosition<span style="color: #990000">;</span>
  <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">double</span> velocity<span style="color: #990000">;</span>
  <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #008080">Road</span> currentRoad<span style="color: #990000">;</span>
  <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
    <span style="font-style: italic"><span style="color: #9A1900">// find closest obstacle</span></span>
    <span style="font-style: italic"><span style="color: #9A1900">// calculate newVelocity</span></span>
    <span style="font-style: italic"><span style="color: #9A1900">// calculate newFrontPosition</span></span>
  <span style="color: #FF0000">}</span>
  <span style="color: #009900">double</span> <span style="font-weight: bold"><span style="color: #000000">backPosition</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> frontPosition<span style="color: #990000">-</span>length<span style="color: #990000">;</span>
  <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>
</tt></pre>

      </td></tr></table><p> </p><table width="100%" class="title"><tr><td><span style="font-weight: bold; font-size: larger"><a name="slide011">Project: Lights</a></span><span style="font-weight: normal"><a href="class-07-011.html"> [11/13] </a></span></td></tr></table><p> </p>
        <p xmlns="">
          Now, how do you add lights to this?
        </p>
        <p xmlns="">
          Think first about a stoplight that sits just between two road segments
          (no intersection).
        </p>
        <p xmlns="">
          One idea:
        </p>

<pre xmlns="" xml:space="preserve"><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Light</span> <span style="font-weight: bold"><span style="color: #0000FF">implements</span></span> CarAcceptor <span style="color: #FF0000">{</span>
  <span style="color: #FF0000">{</span>GREEN<span style="color: #990000">,</span>RED<span style="color: #FF0000">}</span> state<span style="color: #990000">;</span>
  <span style="color: #008080">CarAcceptor</span> nextRoad<span style="color: #990000">;</span>
  <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">double</span> <span style="font-weight: bold"><span style="color: #000000">distanceToObstacle</span></span><span style="color: #990000">(</span><span style="color: #009900">double</span> fromPosition<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> state<span style="color: #990000">==</span>GREEN
      <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> nextRoad<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">distanceToObstacle</span></span><span style="color: #990000">(</span>fromPosition<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
      <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
  <span style="color: #FF0000">}</span>
  <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">setState</span></span><span style="color: #990000">(...)</span> <span style="font-style: italic"><span style="color: #9A1900">// set the state</span></span>
<span style="color: #FF0000">}</span>
</tt></pre>

        <p xmlns="">
          Then set up the objects as follows:
        </p>
<pre xmlns="" xml:space="preserve">
CarGenerator -&gt; Road1 -&gt; Light -&gt; Road2 -&gt; Sink
</pre>
        <p xmlns="">
          How do you coordinate two lights then?
        </p>
        <p xmlns="">
          One idea:
        </p>

<pre xmlns="" xml:space="preserve"><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">TwoWayLightController</span> <span style="font-weight: bold"><span style="color: #0000FF">implements</span></span> Agent <span style="color: #FF0000">{</span>
   Light<span style="color: #990000">[]</span> lights<span style="color: #990000">;</span>
   <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
     <span style="font-style: italic"><span style="color: #9A1900">// change the state of lights...</span></span>
   <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>
</tt></pre>

      <p> </p><table width="100%" class="title"><tr><td><span style="font-weight: bold; font-size: larger"><a name="slide012">Project: Creating the road graph</a></span><span style="font-weight: normal"><a href="class-07-012.html"> [12/13] </a></span></td></tr></table><p> </p>
        <p xmlns="">The instructions call for an object graph
          like this:
        </p>
<pre xmlns="" xml:space="preserve">
          30     40
          |      |
          31     41
          |      |
  10--11--A--13--B--15--16
          |      |
          33     43
          |      |
  20--21--C--23--D--25--26
          |      |
          35     45
          |      |
          36     46
</pre>

        <p xmlns="">
          Here traffic goes left to right and top to bottom.
        </p>
        <ul xmlns="">
          <li>10/20/30/40 are generators.</li>
          <li>16/26/36/46 are sinks.</li>
          <li>11/21/32/42 and 13/23/33/43 and 15/25/35/45 are Roads.</li>
          <li>A/B/C/D are intersections.</li>
        </ul>
        <p xmlns="">
          The object graph you build will look like this:
        </p>
<pre xmlns="" xml:space="preserve">
CarGen10 -&gt; Road11 -&gt; Light12 -&gt; Road13 -&gt; Light14 -&gt; Road15 -&gt; Sink16

CarGen20 -&gt; Road21 -&gt; Light22 -&gt; Road23 -&gt; Light24 -&gt; Road25 -&gt; Sink26

CarGen30 -&gt; Road31 -&gt; Light32 -&gt; Road33 -&gt; Light34 -&gt; Road35 -&gt; Sink36

CarGen40 -&gt; Road41 -&gt; Light42 -&gt; Road43 -&gt; Light44 -&gt; Road45 -&gt; Sink46

      Light12 &lt;- LightControllerA -&gt; Light32

      Light12 &lt;- LightControllerB -&gt; Light42

      Light22 &lt;- LightControllerC -&gt; Light35

      Light22 &lt;- LightControllerD -&gt; Light45
</pre>
        <p xmlns="">
          How do you put all this together?
        </p>
      <p> </p><table width="100%" cellpadding="0" cellspacing="0" class="notes"><tr><td>
<pre xmlns="" xml:space="preserve">
Details will vary from person to person,
so you have to be able to think abstractly and adapt from someone
else's comments to see if anything applies to your own code.  

Suppose we have just two roads and no lights, then the object graph is
likely to look something like:

 r1 --&gt; r3

that is, road 1 has a link to road 2.  In the code this will be a
field, perhaps called "next".  In r3, the next field will be null.
You can create this graph by doing something like this:

 Road r3 = new Road(null);
 Road r1 = new Road(r3);

where the code looks like:

 interface CarAcceptor { ... }
 class Road implements CarAcceptor { CarAcceptor next; ... }

Note that you create the segments "backwards".  Each road needs to
know about the road after it, so you create them in reverse order.

If we use a null object for the sink we get:

 r1 --&gt; r3 --&gt; k4

which you might create like this:

 Sink k4 = new Sink()
 Road r3 = new Road(k4)
 Road r1 = new Road(r3)

Finally, you might add a car generator, or Source:

 s0 --&gt; r1 --&gt; r3 --&gt; k4

 Sink k4 = new Sink()
 Road r3 = new Road(k4)
 Road r1 = new Road(r3)
 Source s0 = new Source(r1)

You expect the code to be something like:

 interface CarAcceptor { ... }
 class Sink implements CarAcceptor { ... }
 class Road implements CarAcceptor { CarAcceptor next; ... }

 interface Agent { ... }
 class Source implements Agent { CarAcceptor first; ... }

If you add a light as I discussed in class, you might have:

 s0 --&gt; r1 --&gt; l2 --&gt; r3 --&gt; k4

 Sink k4 = new Sink()
 Road r3 = new Road(k4)
 Light l2 = new Light(r3)
 LightController c2 = new LightController(l2)
 Road r1 = new Road(r3)
 Source s0 = new Source(r1)

with code along the lines of:

 interface CarAcceptor { ... }
 class Sink implements CarAcceptor { ... }
 class Road implements CarAcceptor { CarAcceptor next; ... }
 class Light implements CarAcceptor { CarAcceptor next; ... }

 interface Agent { ... }
 class Source implements Agent { CarAcceptor first; ... }
 class LightController implements Agent { Light theLight; ... }

Having a LightController hooked up to two lights is an exercise, for
once you get this working.
</pre>
	<p xmlns="">
          Here is an example of code I put out last year.
        </p>
        <p xmlns="">
          In main.Main you are going to need to do all the wiring.
          Something like this should work (not debugged!).
        </p>

<pre xmlns="" xml:space="preserve"><tt><span style="color: #008080">CarGen</span> <span style="font-weight: bold"><span style="color: #000000">makeSegment</span></span><span style="color: #990000">(</span>LightController<span style="color: #990000">[]</span> lc<span style="color: #990000">,</span> <span style="color: #008080">Direction</span> d<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
  <span style="color: #008080">CarAcceptor</span> next <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Road</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Sink</span></span><span style="color: #990000">());</span>
  <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i<span style="color: #990000">&lt;</span>lc<span style="color: #990000">.</span>size<span style="color: #990000">;</span> i<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
     <span style="color: #008080">Light</span> l <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Light</span></span><span style="color: #990000">(</span>next<span style="color: #990000">);</span>
     lc<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setLight</span></span><span style="color: #990000">(</span>l<span style="color: #990000">,</span>d<span style="color: #990000">);</span>
     next <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Road</span></span><span style="color: #990000">(</span>l<span style="color: #990000">);</span>
  <span style="color: #FF0000">}</span>
  <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">CarGen</span></span><span style="color: #990000">(</span>next<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>
<span style="font-style: italic"><span style="color: #9A1900">// rotate a 2D array</span></span>
LightController<span style="color: #990000">[][]</span> <span style="font-weight: bold"><span style="color: #000000">rotate</span></span> <span style="color: #990000">(</span>LightController<span style="color: #990000">[][]</span> orig<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
  LightController<span style="color: #990000">[][]</span> value <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> LightController<span style="color: #990000">[</span>orig<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">].</span>size<span style="color: #990000">][</span>orig<span style="color: #990000">.</span>size<span style="color: #990000">];</span>
  <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i<span style="color: #990000">...)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>j<span style="color: #990000">...)</span>
      value<span style="color: #990000">[</span>i<span style="color: #990000">][</span>j<span style="color: #990000">]</span> <span style="color: #990000">=</span> orig<span style="color: #990000">[</span>j<span style="color: #990000">][</span>i<span style="color: #990000">];</span>
<span style="color: #FF0000">}</span>
<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">makeSquareGrid</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> size<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
  LightController<span style="color: #990000">[][]</span> eastWest <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> LightController<span style="color: #990000">[</span>size<span style="color: #990000">][</span>size<span style="color: #990000">];</span>
  <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> size<span style="color: #990000">;</span> i<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> j <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> j <span style="color: #990000">&lt;</span> size<span style="color: #990000">;</span> j<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
      eastWest<span style="color: #990000">[</span>i<span style="color: #990000">][</span>j<span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">LightController</span></span><span style="color: #990000">();</span>
      TimeServer<span style="color: #990000">.</span>instance<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add</span></span><span style="color: #990000">(</span>eastWest<span style="color: #990000">[</span>i<span style="color: #990000">][</span>j<span style="color: #990000">]);</span>
    <span style="color: #FF0000">}</span>
  <span style="color: #FF0000">}</span>
  LightController<span style="color: #990000">[][]</span> northSouth <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">rotate</span></span><span style="color: #990000">(</span>eastWest<span style="color: #990000">);</span>
  <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> size<span style="color: #990000">;</span> i<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
    TimeServer<span style="color: #990000">.</span>instance<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">makeSegment</span></span><span style="color: #990000">(</span>eastWest<span style="color: #990000">[</span>i<span style="color: #990000">],</span> Direction<span style="color: #990000">.</span>EASTWEST<span style="color: #990000">));</span>
    TimeServer<span style="color: #990000">.</span>instance<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">makeSegment</span></span><span style="color: #990000">(</span>northSouth<span style="color: #990000">[</span>i<span style="color: #990000">],</span> Direction<span style="color: #990000">.</span>NORTHSOUTH<span style="color: #990000">));</span>
  <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>
</tt></pre>

      </td></tr></table><p> </p><table width="100%" class="title"><tr><td><span style="font-weight: bold; font-size: larger"><a name="slide013">Project: Notes</a></span><span style="font-weight: normal"><a href="class-07-013.html"> [13/13] </a></span></td></tr></table><p> </p>
<pre xmlns="" xml:space="preserve">
A ConcurrentModificationException happens when you modify a collection
while iterating through it.  For example:

for (Agent a : Model.agents) {
  GrimReaper.delete(c)
}

GrimReaper {
  delete(Agent a) { Model.agents.remove(a);
}

This will cause a problem, since the grim reaper modifies the
collection that is being iterated through.  You solve the problem by
iterating through a copy:

for (Agent a : Model.agents.copy()) {
  GrimReaper.delete(c)
}

Now the copy is being iterated through, not the original, so no problems.  

-----------------------------------------------------------------------

If I follow the lecture correctly, it seems we only need to modify
SwingAnimationPainterBuilder.java, is that correct?  I know we need to
use the builder to add model components to the model, but is there
other visualization code that we need to touch?

-----------------------------------------------------------------------

I had to edit a lot of things in the animation classes to get  
everything playing nice with the graphics.  The given graphics library  
does not take care of the following:

- Changing of colors (traffic lights)
- Proportionate lengths of roads and intersecitons (i.e., a road may  
look the same size but it's actually longer than the next)
- Drawing moving dots (cars) on the intersections

So I assumed that it was up to us to fix these issues.  I went ahead  
and added the above features as necessary.  The colors of the lights  
can be done through the same sate pattern that controls the traffic.

The lengths of roads can be taken care of by using an equation that  
"normalizes" position of cars so that no matter what the visual is  
drawn up to be the position is normalized to a 0 to 1 double where 0  
is the beginning of the segment or intersection (or whatever the next  
extension you decide to draw) and 1 is the end.

I also had to add builder functions to let the animation know about  
intersections since the cars were disappearing at each intersection.  
It took me a while to figure out that they were still being processed  
but not being drawn.  When the visual of the car goes away it's really  
confusing because it looks like it teleported even though it was still  
moving all along.

Another tip: increase the size of the traffic light dots so they are  
bigger than cars.  This way if there is a lot of gridlock action, you  
can still see the state of each light.  I've got a screenshot here.

-----------------------------------------------------------------------
Can you explain this a bit further?

"The lengths of roads can be taken care of by using an equation that
"normalizes" position of cars so that no matter what the visual is
drawn up to be the position is normalized to a 0 to 1 double where 0
is the beginning of the segment or intersection (or whatever the
next
extension you decide to draw) and 1 is the end."

I think maybe this is my problem with my cars being drawn stopped in
the middle of the next road when they are supposed to be stopped at
the intersection when the light is red.

Are you saying to do something like this...

double roadLength = e.x.getLength();
double normalizedPosition = pos/roadLength;
XGraphics.fillOval(g, e.t, normalizedPosition, 0, MP.dotLength,
VP.elementWidth);

When doing it that way my cars no longer go past a blocked
intersection, but they stay at the start of the line, instead of going
up to the intersection.  Hmmmm.

-----------------------------------------------------------------------

You are REAL close.  Now all you have to do is take care of the offset  
that the dot imposes.  The graphics engine draws the center of the dot  
at "position".  I think this will get you moving in the right  
direction.  Are you using the "frontPosition"?

Also, I just put the formula in the argument for the fillOval  
function.  Then you don't really need to create all the extra  
doubles.  To do this I also added a method to Car called  
GetRoadObjectLength() which returns a double that is the length of the  
road object that the car is currently on.

Oh! and I forgot one more thing.  You now have a position from 0 to  
1.  That wouldn't show much movement for you now would it?  That must  
be why your cars are staying at the front of the road.  Actually if  
you were to look REAL close you would see the car move 1 meter on a  
200 meter road!  You forgot to multiply the "normalized" distance with  
the graphical length of the road, MP.lineLength.

What's real cool about this equation? Go ahead and change the  
MP.lineLength value.  Make it 300 if you like and watch as the  
equation takes care of all your problems!
</pre>
      <hr/><p class="flush">
      Revised: 2008/10/28 10:45</p></body></html>
